<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.4"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>AFBR-S50 API Reference Manual: HAL Self Test</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  extensions: ["tex2jax.js"],
  jax: ["input/TeX","output/HTML-CSS"],
});
</script>
<script type="text/javascript" async="async" src="https://cdn.jsdelivr.net/npm/mathjax@2/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="style.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectlogo"><img alt="Logo" src="AFBR-S50.ico"/></td>
  <td id="projectalign">
   <div id="projectname">AFBR-S50 API Reference Manual<span id="projectnumber">&#160;v1.3.5</span>
   </div>
   <div id="projectbrief">AFBR-S50 Time-of-Flight Sensor SDK for Embedded Software</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.4 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search",'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('group__argus__test.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#define-members">Macros</a> &#124;
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle"><div class="title">HAL Self Test<div class="ingroups"><a class="el" href="group__argus.html">AFBR-S50 SDK</a></div></div></div>
</div><!--header-->
<div class="contents">

<p>A test module to verify implementation of the HAL.  
<a href="#details">More...</a></p>
<div class="dynheader">
Collaboration diagram for HAL Self Test:</div>
<div class="dyncontent">
<div class="center"><img src="group__argus__test.png" border="0" usemap="#agroup____argus____test" alt=""/></div>
<map name="agroup____argus____test" id="agroup____argus____test">
<area shape="rect" href="group__argus.html" title="AFBR&#45;S50 API and Core Libraries." alt="" coords="5,5,120,31"/>
<area shape="rect" title="A test module to verify implementation of the HAL." alt="" coords="168,5,272,31"/>
</map>
</div>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="define-members" name="define-members"></a>
Macros</h2></td></tr>
<tr class="memitem:gaa1166162e755f430cb62825791eb4735"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__argus__test.html#gaa1166162e755f430cb62825791eb4735">HAL_TEST_VERSION</a>&#160;&#160;&#160;&quot;v1.2&quot;</td></tr>
<tr class="memdesc:gaa1166162e755f430cb62825791eb4735"><td class="mdescLeft">&#160;</td><td class="mdescRight">Version number of the HAL Self Test.  <a href="group__argus__test.html#gaa1166162e755f430cb62825791eb4735">More...</a><br /></td></tr>
<tr class="separator:gaa1166162e755f430cb62825791eb4735"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="func-members" name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:gaeaefab65deb7fdee9faeb9f713e88c6d"><td class="memItemLeft" align="right" valign="top"><a class="el" href="group__argus__status.html#gaaabdaf7ee58ca7269bd4bf24efcde092">status_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__argus__test.html#gaeaefab65deb7fdee9faeb9f713e88c6d">Argus_VerifyHALImplementation</a> (<a class="el" href="group__argus__api.html#gaa236b64d7430965890e9c6834e24c317">s2pi_slave_t</a> spi_slave)</td></tr>
<tr class="memdesc:gaeaefab65deb7fdee9faeb9f713e88c6d"><td class="mdescLeft">&#160;</td><td class="mdescRight">Executes a series of tests in order to verify the HAL implementation.  <a href="group__argus__test.html#gaeaefab65deb7fdee9faeb9f713e88c6d">More...</a><br /></td></tr>
<tr class="separator:gaeaefab65deb7fdee9faeb9f713e88c6d"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<p >A test module to verify implementation of the HAL. </p>
<hr  />
<p >A series of automated tests that can be executed on the target platform in order to verify the implementation of the HAL that are required by the API. </p>
<h2 class="groupheader">Macro Definition Documentation</h2>
<a id="gaa1166162e755f430cb62825791eb4735" name="gaa1166162e755f430cb62825791eb4735"></a>
<h2 class="memtitle"><span class="permalink"><a href="#gaa1166162e755f430cb62825791eb4735">&#9670;&nbsp;</a></span>HAL_TEST_VERSION</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define HAL_TEST_VERSION&#160;&#160;&#160;&quot;v1.2&quot;</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Version number of the HAL Self Test. </p>
<hr  />
<p >Changes:</p><ul>
<li>v1.0:<ul>
<li>Initial release.</li>
</ul>
</li>
<li>v1.1:<ul>
<li>Added additional print output.</li>
<li>Increased tolerance for timer test to 3%.</li>
<li>Fixed callback issue by disabling it after IRQ test.</li>
</ul>
</li>
<li>v1.1:<ul>
<li>Added PIT test cases. </li>
</ul>
</li>
</ul>

</div>
</div>
<h2 class="groupheader">Function Documentation</h2>
<a id="gaeaefab65deb7fdee9faeb9f713e88c6d" name="gaeaefab65deb7fdee9faeb9f713e88c6d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#gaeaefab65deb7fdee9faeb9f713e88c6d">&#9670;&nbsp;</a></span>Argus_VerifyHALImplementation()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="group__argus__status.html#gaaabdaf7ee58ca7269bd4bf24efcde092">status_t</a> Argus_VerifyHALImplementation </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="group__argus__api.html#gaa236b64d7430965890e9c6834e24c317">s2pi_slave_t</a>&#160;</td>
          <td class="paramname"><em>spi_slave</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Executes a series of tests in order to verify the HAL implementation. </p>
<hr  />
<p >A series of automated tests are executed on the target platform in order to verify the implementation of the HAL that are required by the API.</p>
<p >Each test will write an error description via the print (i.e. UART) function that shows what went wrong. Also an corresponding status is returned in case no print functionality is available.</p>
<p >The following tests are executed:</p>
<p ><b>1) Timer Plausibility Test:</b></p>
<p >Rudimentary tests of the lifetime counter (LTC) implementation. This verifies that the LTC is running by checking if the returned values of two consecutive calls to the <a class="el" href="group__argus__timer.html#ga1d634822b505ed359998b94acc5ec8ab" title="Obtains the lifetime counter value from the timers.">Timer_GetCounterValue</a> function are ascending. An artificial delay using the NOP operation is induced such that the timer is not read to fast.</p>
<p ><b>2) Timer Wraparound Test:</b></p>
<p >The LTC values must wrap from 999999 µs to 0 µs and increase the seconds counter accordingly. This test verifies the correct wrapping by consecutively calling the <a class="el" href="group__argus__timer.html#ga1d634822b505ed359998b94acc5ec8ab" title="Obtains the lifetime counter value from the timers.">Timer_GetCounterValue</a> function until at least 2 wraparound events have been occurred.</p>
<p ><b>3) SPI Connection Test:</b></p>
<p >This test verifies the basic functionality of the SPI interface. The test utilizes the devices laser pattern register, which can be freely programmed by any 128-bit pattern. Thus, it writes a byte sequence and reads back the written values on the consecutive SPI access.</p>
<p ><b>4) SPI Interrupt Test:</b></p>
<p >This test verifies the correct implementation of the device integration finished interrupt callback. Therefore it configures the device with a minimal setup to run a pseudo measurement that does not emit any laser light.</p>
<p >Note that this test does verify the GPIO interrupt that occurs whenever the device has finished the integration/measurement and new data is waiting to be read from the device. This does not test the interrupt that is triggered when the SPI transfer has finished.</p>
<p >The data ready interrupt implies two S2PI layer functions that are tested in this test: The <a class="el" href="group__argus__s2pi.html#ga8e2c5cf733c131a0856ee3c3d073b29c" title="Set a callback for the GPIO IRQ for a specified S2PI slave.">S2PI_SetIrqCallback</a> function installs a callback function that is invoked whenever the IRQ occurs. The IRQ can be delayed due to higher priority task, e.g. from the user code. It is essential for the laser safety timeout algorithm to determine the device ready signal as fast as possible, another method is implemented to read if the IRQ is pending but the callback has not been reset yet. This is what the <a class="el" href="group__argus__s2pi.html#gad2608e23e402fcf759d57a7ff7c453e6" title="Reads the current status of the IRQ pin.">S2PI_ReadIrqPin</a> function is for.</p>
<p ><b>5) GPIO Mode Test:</b></p>
<p >This test verifies the GPIO mode of the S2PI HAL module. This is done by leveraging the EEPROM readout sequence that accesses the devices EEPROM via a software protocol that depends on the GPIO mode.</p>
<p >This the requires several steps, most of them are already verified in previous tests:</p>
<ul>
<li>Basic device configuration and enable EEPROM.</li>
<li>Read EERPOM via GPIO mode and apply Hamming weight.</li>
<li>Repeat several times (to eliminate random readout issues).</li>
<li>Decode the EEPROM (using EEPROM_Decode in argus_cal_eeprom.c).</li>
<li>Check if Module Number and Chip ID is not 0.</li>
</ul>
<p ><b>6) Timer Test for Lifetime Counter:</b></p>
<p >The test verifies the lifetime counter timer HAL implementation by comparing the timings to the AFBR-S50 device as a reference. Therefore several measurement are executed on the device, each with a different averaging sample count. The elapsed time increases linearly with the number of averaging samples. In order to remove the time for software/setup, a linear regression fit is applied to the measurement results and only the slope is considered for the result. A delta of 102.4 microseconds per sample is expected. If the measured delta per sample is within an specified error range, the timer implementation is considered correct.</p>
<p ><b>7) Timer Test for Periodic Interrupt Timer:</b></p>
<p >The test verifies the correct implementation of the periodic interrupt timer (PIT). It sets different intervals and waits for a certain number of interrupts to happen. Each interrupt event is counted and the time between the first and the last interrupt is measured. Finally, the measured interval is compared to the expectations.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">spi_slave</td><td>The SPI hardware slave, i.e. the specified CS and IRQ lines. This is actually just a number that is passed to the SPI interface to distinct for multiple SPI slave devices. Note that the slave must be not equal to 0, since is reserved for error handling.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>Returns the <a class="el" href="group__argus__status.html#gaaabdaf7ee58ca7269bd4bf24efcde092">status</a> (<a class="el" href="group__argus__status.html#gga67a0db04d321a74b7e7fcfd3f1a3f70ba7e4a42e3b6dd63708c64cf3db6f69566">STATUS_OK</a> on success). </dd></dl>

</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- HTML footer for doxygen 1.8.13-->
<!-- start footer part -->
<div id="nav-path" class="navpath">
	<!-- id is needed for treeview function! -->
	<ul>
		<li class="footer"> 
			<a href="https://www.broadcom.com/">Broadcom Inc.</a>
		</li>
	</ul>
</div>
</body>
</html>
