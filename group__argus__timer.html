<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.12.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>AFBR-S50 API Reference Manual: Timer: Hardware Timer Interface</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  extensions: ["tex2jax.js"],
  jax: ["input/TeX","output/HTML-CSS"],
});
</script>
<script type="text/javascript" async="async" src="https://cdn.jsdelivr.net/npm/mathjax@2/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="style.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectlogo"><img alt="Logo" src="AFBR-S50.ico"/></td>
  <td id="projectalign">
   <div id="projectname">AFBR-S50 API Reference Manual<span id="projectnumber">&#160;v1.6.5</span>
   </div>
   <div id="projectbrief">AFBR-S50 Time-of-Flight Sensor SDK for Embedded Software</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.12.0 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() { codefold.init(0); });
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search',true);
  $(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function(){initNavTree('group__argus__timer.html',''); initResizable(true); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div class="header">
  <div class="summary">
<a href="#typedef-members">Typedefs</a> &#124;
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle"><div class="title">Timer: Hardware Timer Interface<div class="ingroups"><a class="el" href="group__argus.html">AFBR-S50 SDK</a> &raquo; <a class="el" href="group__argus__hal.html">Hardware Abstraction Layers</a></div></div></div>
</div><!--header-->
<div class="contents">

<p>Timer implementations for lifetime counting as well as periodic callback.  
<a href="#details">More...</a></p>
<div class="dynheader">
Collaboration diagram for Timer: Hardware Timer Interface:</div>
<div class="dyncontent">
<div class="center"><img src="group__argus__timer.png" border="0" usemap="#agroup____argus____timer" alt=""/></div>
<map name="agroup____argus____timer" id="agroup____argus____timer">
<area shape="rect" href="group__argus__hal.html" title="Collection of all interfaces for the Hardware Abstraction Layers (HAL)." alt="" coords="5,5,152,46"/>
<area shape="rect" title="Timer implementations for lifetime counting as well as periodic callback." alt="" coords="200,5,352,46"/>
</map>
</div>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="typedef-members" name="typedef-members"></a>
Typedefs</h2></td></tr>
<tr class="memitem:gab61822fc55d1007b31bea7298a0b7574" id="r_gab61822fc55d1007b31bea7298a0b7574"><td class="memItemLeft" align="right" valign="top">typedef void(*&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#gab61822fc55d1007b31bea7298a0b7574">timer_cb_t</a>) (void *param)</td></tr>
<tr class="memdesc:gab61822fc55d1007b31bea7298a0b7574"><td class="mdescLeft">&#160;</td><td class="mdescRight">The callback function type for periodic interrupt timer.  <br /></td></tr>
<tr class="separator:gab61822fc55d1007b31bea7298a0b7574"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="func-members" name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:ga1d634822b505ed359998b94acc5ec8ab" id="r_ga1d634822b505ed359998b94acc5ec8ab"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ga1d634822b505ed359998b94acc5ec8ab">Timer_GetCounterValue</a> (uint32_t *hct, uint32_t *lct)</td></tr>
<tr class="memdesc:ga1d634822b505ed359998b94acc5ec8ab"><td class="mdescLeft">&#160;</td><td class="mdescRight">Obtains the lifetime counter value from the timers.  <br /></td></tr>
<tr class="separator:ga1d634822b505ed359998b94acc5ec8ab"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga9feb1e1bebe79528bd1b961fab936f24" id="r_ga9feb1e1bebe79528bd1b961fab936f24"><td class="memItemLeft" align="right" valign="top"><a class="el" href="group__argus__status.html#gaaabdaf7ee58ca7269bd4bf24efcde092">status_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ga9feb1e1bebe79528bd1b961fab936f24">Timer_SetCallback</a> (<a class="el" href="#gab61822fc55d1007b31bea7298a0b7574">timer_cb_t</a> f)</td></tr>
<tr class="memdesc:ga9feb1e1bebe79528bd1b961fab936f24"><td class="mdescLeft">&#160;</td><td class="mdescRight">Installs an periodic timer callback function.  <br /></td></tr>
<tr class="separator:ga9feb1e1bebe79528bd1b961fab936f24"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga36c65741d5af60b261e68308c0fa9c5f" id="r_ga36c65741d5af60b261e68308c0fa9c5f"><td class="memItemLeft" align="right" valign="top"><a class="el" href="group__argus__status.html#gaaabdaf7ee58ca7269bd4bf24efcde092">status_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ga36c65741d5af60b261e68308c0fa9c5f">Timer_SetInterval</a> (uint32_t dt_microseconds, void *param)</td></tr>
<tr class="memdesc:ga36c65741d5af60b261e68308c0fa9c5f"><td class="mdescLeft">&#160;</td><td class="mdescRight">Sets the timer interval for a specified callback parameter.  <br /></td></tr>
<tr class="separator:ga36c65741d5af60b261e68308c0fa9c5f"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<p>Timer implementations for lifetime counting as well as periodic callback. </p>
<hr  />
  <p>The module provides an interface to the timing utilities that are required by the AFBR-S50 time-of-flight sensor API.</p>
<p>Two essential features have to be provided by the user code:</p><ol type="1">
<li>Time Measurement Capability: In order to keep track of outgoing signals, the API needs to measure elapsed time. In order to provide optimum device performance, the granularity should be around 10 to 100 microseconds.</li>
<li>Periodic Callback: The API provides an automatic starting of measurement cycles at a fixed frame rate via a periodic interrupt timer. If this feature is not used, implementation of the periodic interrupts can be skipped. An weak default implementation is provide in the API.</li>
</ol>
<p>The time measurement feature is simply implemented by the function <a class="el" href="#ga1d634822b505ed359998b94acc5ec8ab" title="Obtains the lifetime counter value from the timers.">Timer_GetCounterValue</a>. Whenever the function is called, the provided counter values must be written with the values obtained by the current time.</p>
<p>The periodic interrupt timer is a simple callback interface. After installing the callback function pointer via <a class="el" href="#ga9feb1e1bebe79528bd1b961fab936f24" title="Installs an periodic timer callback function.">Timer_SetCallback</a>, the timer can be started by setting interval via <a class="el" href="#ga36c65741d5af60b261e68308c0fa9c5f" title="Sets the timer interval for a specified callback parameter.">Timer_SetInterval</a>. From then, the callback is invoked periodically as the corresponding interval may specify. The timer is stopped by setting the interval to 0 using the <a class="el" href="#ga36c65741d5af60b261e68308c0fa9c5f" title="Sets the timer interval for a specified callback parameter.">Timer_SetInterval</a> function. The interval can be updated at any time by updating the interval via the <a class="el" href="#ga36c65741d5af60b261e68308c0fa9c5f" title="Sets the timer interval for a specified callback parameter.">Timer_SetInterval</a> function. To any of these functions, an abstract parameter pointer must be passed. This parameter is passed back to the callback any time it is invoked.</p>
<p>In order to provide the usage of multiple devices, an mechanism is introduced to allow the installation of multiple callback interval at the same time. Therefore, the abstract parameter pointer is used to identify the corresponding callback interval. For example, there are two callbacks for two intervals, t1 and t2, required. The user can start two timers by calling the <a class="el" href="#ga36c65741d5af60b261e68308c0fa9c5f" title="Sets the timer interval for a specified callback parameter.">Timer_SetInterval</a> method twice, but with an individual parameter pointer, ptr1 and ptr2, each: </p><div class="fragment"><div class="line"><a class="code hl_function" href="#ga36c65741d5af60b261e68308c0fa9c5f">Timer_SetInterval</a>(100000, ptr1); <span class="comment">// 10 ms callback w/ parameter ptr1</span></div>
<div class="line"><a class="code hl_function" href="#ga36c65741d5af60b261e68308c0fa9c5f">Timer_SetInterval</a>(200000, ptr2); <span class="comment">// 20 ms callback w/ parameter ptr1</span></div>
<div class="ttc" id="agroup__argus__timer_html_ga36c65741d5af60b261e68308c0fa9c5f"><div class="ttname"><a href="#ga36c65741d5af60b261e68308c0fa9c5f">Timer_SetInterval</a></div><div class="ttdeci">status_t Timer_SetInterval(uint32_t dt_microseconds, void *param)</div><div class="ttdoc">Sets the timer interval for a specified callback parameter.</div></div>
</div><!-- fragment --><p>Note that the implemented timer module must therefore support as many different intervals as instances of the AFBR-S50 device are used.</p>
<h2 class="groupheader">Typedef Documentation</h2>
<a id="gab61822fc55d1007b31bea7298a0b7574" name="gab61822fc55d1007b31bea7298a0b7574"></a>
<h2 class="memtitle"><span class="permalink"><a href="#gab61822fc55d1007b31bea7298a0b7574">&#9670;&#160;</a></span>timer_cb_t</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">typedef void(* timer_cb_t) (void *param)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>The callback function type for periodic interrupt timer. </p>
<hr  />
 <p>The function that is invoked every time a specified interval elapses. An abstract parameter is passed to the function whenever it is called.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">param</td><td>An abstract parameter to be passed to the callback. This is also the identifier of the given interval. </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<h2 class="groupheader">Function Documentation</h2>
<a id="ga1d634822b505ed359998b94acc5ec8ab" name="ga1d634822b505ed359998b94acc5ec8ab"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga1d634822b505ed359998b94acc5ec8ab">&#9670;&#160;</a></span>Timer_GetCounterValue()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void Timer_GetCounterValue </td>
          <td>(</td>
          <td class="paramtype">uint32_t *</td>          <td class="paramname"><span class="paramname"><em>hct</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint32_t *</td>          <td class="paramname"><span class="paramname"><em>lct</em></span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Obtains the lifetime counter value from the timers. </p>
<hr  />
 <p>The function is required to get the current time relative to any point in time, e.g. the startup time. The returned values <code>hct</code> and <code>lct</code> are given in seconds and microseconds respectively. The current elapsed time since the reference time is then calculated from:</p>
<p>t_now [µsec] = hct * 1000000 µsec + lct * 1 µsec</p>
<p>Note that the accuracy/granularity of the lifetime counter does not need to be 1 µsec. Usually, a granularity of approximately 100 µsec is sufficient. However, in case of very high frame rates (above 1000 frames per second), it is recommended to implement an even lower granularity (somewhere in the 10 µsec regime).</p>
<p>It must be guaranteed, that each call of the <a class="el" href="#ga1d634822b505ed359998b94acc5ec8ab" title="Obtains the lifetime counter value from the timers.">Timer_GetCounterValue</a> function must provide a value that is greater or equal, but never lower, than the value returned from the previous call.</p>
<p>A hardware based implementation of the lifetime counter functionality would be to chain two distinct timers such that counter 2 increases its value when counter 1 wraps to 0. The easiest way is to setup counter 1 to wrap exactly every second. Counter 1 would than count the sub-seconds (i.e. µsec) value (<code>lct</code>) and counter 2 the seconds (<code>hct</code>) value. A 16-bit counter is sufficient in case of counter 1 while counter 2 must be a 32-bit version.</p>
<p>In case of a lack of available hardware timers, a software solution can be used that requires only a 16-bit timer. In a simple scenario, the timer is configured to wrap around every second and increase a software counter value in its interrupt service routine (triggered with the wrap around event) every time the wrap around occurs.</p>
<dl class="section note"><dt>Note</dt><dd>The implementation of this function is mandatory for the correct execution of the API.</dd></dl>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">hct</td><td>A pointer to the high counter value bits representing current time in seconds.</td></tr>
    <tr><td class="paramname">lct</td><td>A pointer to the low counter value bits representing current time in microseconds. Range: 0, .., 999999 µsec </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="ga9feb1e1bebe79528bd1b961fab936f24" name="ga9feb1e1bebe79528bd1b961fab936f24"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga9feb1e1bebe79528bd1b961fab936f24">&#9670;&#160;</a></span>Timer_SetCallback()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="group__argus__status.html#gaaabdaf7ee58ca7269bd4bf24efcde092">status_t</a> Timer_SetCallback </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="#gab61822fc55d1007b31bea7298a0b7574">timer_cb_t</a></td>          <td class="paramname"><span class="paramname"><em>f</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Installs an periodic timer callback function. </p>
<hr  />
 <p>Installs an periodic timer callback function that is invoked whenever an interval elapses. The callback is the same for any interval, however, the single intervals can be identified by the passed parameter. Passing a zero-pointer removes and disables the callback.</p>
<dl class="section note"><dt>Note</dt><dd>The implementation of this function is optional for the correct execution of the API. If not implemented, a weak implementation within the API will be used that disable the periodic timer callback and thus the automatic starting of measurements from the background.</dd></dl>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">f</td><td>The timer callback function.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>Returns the <a class="el" href="group__argus__status.html#gaaabdaf7ee58ca7269bd4bf24efcde092">status</a> (<a class="el" href="group__argus__status.html#gga67a0db04d321a74b7e7fcfd3f1a3f70ba7e4a42e3b6dd63708c64cf3db6f69566">STATUS_OK</a> on success). </dd></dl>

</div>
</div>
<a id="ga36c65741d5af60b261e68308c0fa9c5f" name="ga36c65741d5af60b261e68308c0fa9c5f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga36c65741d5af60b261e68308c0fa9c5f">&#9670;&#160;</a></span>Timer_SetInterval()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="group__argus__status.html#gaaabdaf7ee58ca7269bd4bf24efcde092">status_t</a> Timer_SetInterval </td>
          <td>(</td>
          <td class="paramtype">uint32_t</td>          <td class="paramname"><span class="paramname"><em>dt_microseconds</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *</td>          <td class="paramname"><span class="paramname"><em>param</em></span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Sets the timer interval for a specified callback parameter. </p>
<hr  />
 <p>Sets the callback interval for the specified parameter and starts the timer with a new interval. If there is already an interval with the given parameter, the timer is restarted with the given interval. If the same time interval as already set is passed, nothing happens. Passing a interval of 0 disables the timer.</p>
<p>When enabling the timer (or resetting by applying another interval), the first timer interrupt must happen after the specified interval.</p>
<p>Note that a microsecond granularity for the timer interrupt period is not required. Usually a milliseconds granularity is sufficient. The required granularity depends on the targeted frame rate, e.g. in case of more than 1 kHz measurement rate, a granularity of less than a millisecond is required to achieve the given frame rate.</p>
<dl class="section note"><dt>Note</dt><dd>The implementation of this function is optional for the correct execution of the API. If not implemented, a weak implementation within the API will be used that disable the periodic timer callback and thus the automatic starting of measurements from the background.</dd></dl>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">dt_microseconds</td><td>The callback interval in microseconds.</td></tr>
    <tr><td class="paramname">param</td><td>An abstract parameter to be passed to the callback. This is also the identifier of the given interval.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>Returns the <a class="el" href="group__argus__status.html#gaaabdaf7ee58ca7269bd4bf24efcde092">status</a> (<a class="el" href="group__argus__status.html#gga67a0db04d321a74b7e7fcfd3f1a3f70ba7e4a42e3b6dd63708c64cf3db6f69566">STATUS_OK</a> on success). </dd></dl>

</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- HTML footer for doxygen 1.8.13-->
<!-- start footer part -->
<div id="nav-path" class="navpath">
	<!-- id is needed for treeview function! -->
	<ul>
		<li class="footer"> 
			<a href="https://www.broadcom.com/">Broadcom Inc.</a>
		</li>
	</ul>
</div>
</body>
</html>
