<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>AFBR-S50 SDK - Argus API Reference Manual: Getting Started</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
</script>
<script type="text/javascript" async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="style.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="AFBR-S50.ico"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">AFBR-S50 SDK - Argus API Reference Manual
   &#160;<span id="projectnumber">v1.2.3</span>
   </div>
   <div id="projectbrief">AFBR-S50 Time-of-Flight Sensor SDK for Embedded Software</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('getting_started.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Getting Started </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="md_Doxygen_03_getting_started"></a> The following section gives an brief overview on of the <b>AFBR-S50 Core Library and API</b> and shows how to get started using the evaluation platform and example files. If a port to another microcontroller platform is required, refer to the <a class="el" href="porting_guide.html">Porting Guide</a>.</p>
<h1><a class="anchor" id="gs_api"></a>
AFBR-S50 API</h1>
<dl class="section note"><dt>Note</dt><dd>All <b>AFBR-S50 API</b> related functions, definitions and constants have a prefix "**Argus**" which is essentially an alias or working title for the <b>AFBR-S50 Time-of-Flight Sensor</b> device.</dd></dl>
<p>The <em>AFBR-S50 Core Library</em> is provided as a static ANSI-C library file ("lib*.a") and the corresponding API is provided as ANSI-C header files ("*.h"). After setting up the linker to link the library, it is sufficient to include the main header in the "/include" folder, "argus.h": </p><div class="fragment"><div class="line">#include &quot;argus.h&quot;</div>
</div><!-- fragment --><p>The API utilizes an abstract handler object that contains all internal states for a single time-of-flight sensor device. In this way, it is possible to use the same API with more than a single device. Note, however, that this feature is not fully implemented in the current version and is planned for a future release! After including the header file, the handler object must be created by calling the <a class="el" href="group__argusapi.html#ga0c81d41a6c8aecceca64b54c724b6a2d" title="Creates a new device data handle object to store all internal states.">Argus_CreateHandle</a> function to obtain a pointer to the newly allocated object. This is done via the standard library function: </p><div class="fragment"><div class="line">void * malloc(size_t size) </div>
</div><!-- fragment --><p> If it is required to use a different function, create and overwrite the weakly linked method and implement your own memory allocation algorithm: </p><div class="fragment"><div class="line">void * Argus_Malloc(size_t size) { /* ... */ } </div>
</div><!-- fragment --><p>After creation of the handler object, the <em>AFBR-S50</em> module must be initialized with the corresponding handler object: </p><div class="fragment"><div class="line">status_t status = Argus_Init(hnd, SPI_SLAVE); </div>
</div><!-- fragment --><p> Note that all peripheral modules must be ready to be used before executing any API function. So make sure to initialize the board and its peripherals before. Now the device is ready to run and has setup with default configuration and calibration data. Use the provided API functions to customize the given default configuration to the needs and requirements of the application.</p>
<p>From then, there are two possibilities to operate the device. First, the simple polling method. The measurements are triggered by the main program via calling the <a class="el" href="group__argusmeas.html#ga92c7d4e2cdfccff38bf6689935e088a5" title="Triggers a single measurement frame asynchronously.">Argus_TriggerMeasurement</a> function any time a new measurement should be started. A new measurement frame is started and after reading the data from the device, the callback is invoked to inform the host application about the data ready event. In the meantime, the host application can poll the module status or execute other tasks. After finishing the measurement, the <a class="el" href="group__argusmeas.html#ga39cbc3ebea33bbc497cadd393254c239" title="Evaluate useful information from the raw measurement data.">Argus_EvaluateData</a> function must be called to obtain measurement data like range from the raw readout data. It is mandatory to call the evaluation method. Otherwise, the raw data buffer is kept occupied and no new measurement can be started anymore. The module contains however a double buffer architecture, which allows to start the next measurement and evaluate the current measurement data while the device executes a new measurement frame. After evaluation, the <a class="el" href="structargus__results__t.html" title="The measurement results data structure.">argus_results_t</a> data structure is filled with all measurement results that can be processed now be processed by the host application depending on the users needs. An example implementation is shown in the <a class="el" href="getting_started.html#gs_simple_example">Simple Example</a> section.</p>
<p>Please note that the laser safety module might refuse to restart a measurement at the time the function is called. This is due to timing constraints dictated by the laser safety rules. The frame time and similar parameters can be adjusted with the configuration API methods.</p>
<p>The second way of operating the device is to leverage from an periodic interrupt time that invokes a callback to the API in periodic manner. The timer is implemented in the <a class="el" href="group__argus__timer.html">timer</a> interface. Instead of calling the <a class="el" href="group__argusmeas.html#ga92c7d4e2cdfccff38bf6689935e088a5" title="Triggers a single measurement frame asynchronously.">Argus_TriggerMeasurement</a> function periodically from the host application, the measurement restarts itself in an autonomous way. Every time, a new raw measurement data set is ready, the measurement data ready callback is invoked by the API. Similar to the previous method, the <a class="el" href="group__argusmeas.html#ga39cbc3ebea33bbc497cadd393254c239" title="Evaluate useful information from the raw measurement data.">Argus_EvaluateData</a> function must be called before the data can be used. Note that not calling the function will lead to measurements are not restarted before the evaluation method is called and the data buffers is freed. In the same manner, a slow data evaluation or much user code to delay the data evaluation method might decrease the measurement frame rate. An example implementation is shown in the <a class="el" href="getting_started.html#gs_adv_example">Advanced Example</a> section.</p>
<h1><a class="anchor" id="gs_simple_example"></a>
Simple Example</h1>
<p>Here is an example of how to use the API in a simple loop with polling the module status to wait for the measurement data to be ready. The 1D range value of the obtained measurement data is streamed via an UART connection. Open a terminal (e.g. <a href="https://www.compuphase.com/software_termite.htm">Termite</a>) and open a UART connection using 115200 bps, 8N1, no handshake connection. Range values will start to occur on the terminal as soon as the program starts its execution.</p>
<div class="fragment"><div class="line"><span class="comment">/*******************************************************************************</span></div>
<div class="line"><span class="comment"> * Include Files</span></div>
<div class="line"><span class="comment"> ******************************************************************************/</span></div>
<div class="line"><span class="preprocessor">#include &quot;<a class="code" href="argus_8h.html">argus.h</a>&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;board/clock_config.h&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;driver/cop.h&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;driver/gpio.h&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;driver/s2pi.h&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;driver/uart.h&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;driver/timer.h&quot;</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">/*******************************************************************************</span></div>
<div class="line"><span class="comment"> * Defines</span></div>
<div class="line"><span class="comment"> ******************************************************************************/</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#define SPI_SLAVE 1</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#define SPI_BAUD_RATE 6000000</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">/*******************************************************************************</span></div>
<div class="line"><span class="comment"> * Variables</span></div>
<div class="line"><span class="comment"> ******************************************************************************/</span></div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keyword">volatile</span> <span class="keywordtype">void</span> * myData = 0;</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="comment">/*******************************************************************************</span></div>
<div class="line"><span class="comment"> * Prototypes</span></div>
<div class="line"><span class="comment"> ******************************************************************************/</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">/*!***************************************************************************</span></div>
<div class="line"><span class="comment"> * @brief   printf-like function to send print messages via UART.</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> * @details Defined in &quot;driver/uart.c&quot; source file.</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> *          Open an UART connection with 115200 bps, 8N1, no handshake to</span></div>
<div class="line"><span class="comment"> *          receive the data on a computer.</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> * @param   fmt_s : The usual printf parameters.</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> * @return  Returns the \link #status_t status\endlink (#STATUS_OK on success).</span></div>
<div class="line"><span class="comment"> *****************************************************************************/</span></div>
<div class="line"><span class="keyword">extern</span> <a class="code" href="group__status.html#gaaabdaf7ee58ca7269bd4bf24efcde092">status_t</a> <a class="code" href="group__argus__log.html#gaf623b0ecc471d68c31c110c6f9abd7d2">print</a>(<span class="keyword">const</span> <span class="keywordtype">char</span>  *fmt_s, ...);</div>
<div class="line"> </div>
<div class="line"><span class="comment">/*!***************************************************************************</span></div>
<div class="line"><span class="comment"> * @brief   Initialization routine for board hardware and peripherals.</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> * @return  -</span></div>
<div class="line"><span class="comment"> *****************************************************************************/</span></div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> hardware_init(<span class="keywordtype">void</span>);</div>
<div class="line"> </div>
<div class="line"><span class="comment">/*!***************************************************************************</span></div>
<div class="line"><span class="comment"> * @brief   Measurement data ready callback function.</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> * @details</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> * @param   status :</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> * @param   data :</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> * @return  Returns the \link #status_t status\endlink (#STATUS_OK on success).</span></div>
<div class="line"><span class="comment"> *****************************************************************************/</span></div>
<div class="line"><a class="code" href="group__status.html#gaaabdaf7ee58ca7269bd4bf24efcde092">status_t</a> measurement_ready_callback(<a class="code" href="group__status.html#gaaabdaf7ee58ca7269bd4bf24efcde092">status_t</a> status, <span class="keywordtype">void</span> * data);</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="comment">/*******************************************************************************</span></div>
<div class="line"><span class="comment"> * Code</span></div>
<div class="line"><span class="comment"> ******************************************************************************/</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">/*!***************************************************************************</span></div>
<div class="line"><span class="comment"> * @brief   Application entry point.</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> * @details The main function of the program, called after startup code</span></div>
<div class="line"><span class="comment"> *          This function should never be exited.</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> * @return  -</span></div>
<div class="line"><span class="comment"> *****************************************************************************/</span></div>
<div class="line"><span class="keywordtype">int</span> main(<span class="keywordtype">void</span>)</div>
<div class="line">{</div>
<div class="line">    <span class="comment">/* The API module handle that contains all data definitions that is</span></div>
<div class="line"><span class="comment">     * required within the API module for the corresponding hardware device.</span></div>
<div class="line"><span class="comment">     * Every call to an API function requires the passing of a pointer to this</span></div>
<div class="line"><span class="comment">     * data structure. */</span></div>
<div class="line">    <a class="code" href="group__argusapi.html#ga0ff472df08ed31ebbc16d3c6cf0c6564">argus_hnd_t</a> * hnd = <a class="code" href="group__argusapi.html#ga0c81d41a6c8aecceca64b54c724b6a2d">Argus_CreateHandle</a>();</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (hnd == 0)</div>
<div class="line">    {</div>
<div class="line">        <span class="comment">/* Error Handling ...*/</span></div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="comment">/* Initialize the platform hardware including the required peripherals</span></div>
<div class="line"><span class="comment">     * for the API. */</span></div>
<div class="line">    hardware_init();</div>
<div class="line"> </div>
<div class="line">    <span class="comment">/* Initialize the API with default values.</span></div>
<div class="line"><span class="comment">     * This implicitly calls the initialization functions</span></div>
<div class="line"><span class="comment">     * of the underlying API modules.</span></div>
<div class="line"><span class="comment">     *</span></div>
<div class="line"><span class="comment">     * The second parameter is stored and passed to all function calls</span></div>
<div class="line"><span class="comment">     * to the S2PI module. This piece of information can be utilized in</span></div>
<div class="line"><span class="comment">     * order to determine the addressed SPI slave and enabled the usage</span></div>
<div class="line"><span class="comment">     * of multiple devices on a single SPI peripheral. */</span></div>
<div class="line">    <a class="code" href="group__status.html#gaaabdaf7ee58ca7269bd4bf24efcde092">status_t</a> status = <a class="code" href="group__argusapi.html#ga7d724a6657138f112bff554f7db2a898">Argus_Init</a>(hnd, SPI_SLAVE);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (status != <a class="code" href="group__status.html#gga67a0db04d321a74b7e7fcfd3f1a3f70ba7e4a42e3b6dd63708c64cf3db6f69566">STATUS_OK</a>)</div>
<div class="line">    {</div>
<div class="line">        <span class="comment">/* Error Handling ...*/</span></div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="comment">/* Adjust some configuration parameters by invoking the dedicated API methods. */</span></div>
<div class="line">    <a class="code" href="group__arguscfg.html#gaa6d970c42ac21e56907247f58a029472">Argus_SetConfigurationFrameTime</a>(hnd, 100000); <span class="comment">// 0.1 second = 10 Hz</span></div>
<div class="line"> </div>
<div class="line">    <span class="comment">/* The program loop ... */</span></div>
<div class="line">    <span class="keywordflow">for</span>(;;)</div>
<div class="line">    {</div>
<div class="line">        myData = 0;</div>
<div class="line"> </div>
<div class="line">        <span class="comment">/* Triggers a single measurement.</span></div>
<div class="line"><span class="comment">         * Note that due to the laser safety algorithms, the method might refuse</span></div>
<div class="line"><span class="comment">         * to restart a measurement when the appropriate time has not been elapsed</span></div>
<div class="line"><span class="comment">         * right now. The function returns with status #STATUS_ARGUS_POWERLIMIT and</span></div>
<div class="line"><span class="comment">         * the function must be called again later. Use the frame time configuration</span></div>
<div class="line"><span class="comment">         * in order to adjust the timing between two measurement frames. */</span></div>
<div class="line">        status = <a class="code" href="group__argusmeas.html#ga92c7d4e2cdfccff38bf6689935e088a5">Argus_TriggerMeasurement</a>(hnd, measurement_ready_callback);</div>
<div class="line">        <span class="keywordflow">if</span> (status == <a class="code" href="group__status.html#gga67a0db04d321a74b7e7fcfd3f1a3f70ba3ec68d249b5ffaa0da7e0a1170f592a2">STATUS_ARGUS_POWERLIMIT</a>)</div>
<div class="line">        {</div>
<div class="line">            <span class="comment">/* Not ready (due to laser safety) to restart the measurement yet.</span></div>
<div class="line"><span class="comment">             * Come back later. */</span></div>
<div class="line">            __asm(<span class="stringliteral">&quot;nop&quot;</span>);</div>
<div class="line">        }</div>
<div class="line">        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (status != <a class="code" href="group__status.html#gga67a0db04d321a74b7e7fcfd3f1a3f70ba7e4a42e3b6dd63708c64cf3db6f69566">STATUS_OK</a>)</div>
<div class="line">        {</div>
<div class="line">            <span class="comment">/* Error Handling ...*/</span></div>
<div class="line">        }</div>
<div class="line">        <span class="keywordflow">else</span></div>
<div class="line">        {</div>
<div class="line">            <span class="comment">/* Wait until measurement data is ready. */</span></div>
<div class="line">            <span class="keywordflow">do</span></div>
<div class="line">            {</div>
<div class="line">                status = <a class="code" href="group__argusmeas.html#gaa80d0b10b2366f0ade05b4d7b9243497">Argus_GetStatus</a>(hnd);</div>
<div class="line">                __asm(<span class="stringliteral">&quot;nop&quot;</span>);</div>
<div class="line">            }</div>
<div class="line">            <span class="keywordflow">while</span>(status == <a class="code" href="group__status.html#gga67a0db04d321a74b7e7fcfd3f1a3f70ba27b7b4ca606d6208a2ada6df1af6ab88">STATUS_BUSY</a>);</div>
<div class="line"> </div>
<div class="line">            <span class="keywordflow">if</span> (status != <a class="code" href="group__status.html#gga67a0db04d321a74b7e7fcfd3f1a3f70ba7e4a42e3b6dd63708c64cf3db6f69566">STATUS_OK</a>)</div>
<div class="line">            {</div>
<div class="line">                <span class="comment">/* Error Handling ...*/</span></div>
<div class="line">            }</div>
<div class="line"> </div>
<div class="line">            <span class="keywordflow">else</span></div>
<div class="line">            {</div>
<div class="line">                <span class="comment">/* The measurement data structure. */</span></div>
<div class="line">                <a class="code" href="structargus__results__t.html">argus_results_t</a> res;</div>
<div class="line"> </div>
<div class="line">                <span class="comment">/* Evaluate the raw measurement results. */</span></div>
<div class="line">                status = <a class="code" href="group__argusmeas.html#ga39cbc3ebea33bbc497cadd393254c239">Argus_EvaluateData</a>(hnd, &amp;res, (<span class="keywordtype">void</span>*)myData);</div>
<div class="line"> </div>
<div class="line">                <span class="keywordflow">if</span> (status != <a class="code" href="group__status.html#gga67a0db04d321a74b7e7fcfd3f1a3f70ba7e4a42e3b6dd63708c64cf3db6f69566">STATUS_OK</a>)</div>
<div class="line">                {</div>
<div class="line">                    <span class="comment">/* Error Handling ...*/</span></div>
<div class="line">                }</div>
<div class="line"> </div>
<div class="line">                <span class="keywordflow">else</span></div>
<div class="line">                {</div>
<div class="line">                    <span class="comment">/* Use the recent measurement results</span></div>
<div class="line"><span class="comment">                     * (converting the Q9.22 value to float and print or display it). */</span></div>
<div class="line">                    <a class="code" href="group__argus__log.html#gaf623b0ecc471d68c31c110c6f9abd7d2">print</a>(<span class="stringliteral">&quot;Range: %d mm\n&quot;</span>, res.<a class="code" href="structargus__results__t.html#aff9b50b61955470fa1d349b4fb17ff1e">Bin</a>.<a class="code" href="structargus__results__bin__t.html#a830e9e333b9fece506f2e72b92087a51">Range</a> / (<a class="code" href="group__fixedpoint.html#gae92e284f44eb56820cf5a1d330ce4c0f">Q9_22_ONE</a> / 1000));</div>
<div class="line">                }</div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> hardware_init(<span class="keywordtype">void</span>)</div>
<div class="line">{</div>
<div class="line">    <span class="comment">/* Initialize the board with clocks. */</span></div>
<div class="line">    BOARD_ClockInit();</div>
<div class="line"> </div>
<div class="line">    <span class="comment">/* Disable the watchdog timer. */</span></div>
<div class="line">    COP_Disable();</div>
<div class="line"> </div>
<div class="line">    <span class="comment">/* Init GPIO ports. */</span></div>
<div class="line">    GPIO_Init();</div>
<div class="line"> </div>
<div class="line">    <span class="comment">/* Initialize timer required by the API. */</span></div>
<div class="line">    Timer_Init();</div>
<div class="line"> </div>
<div class="line">    <span class="comment">/* Initialize UART for print functionality. */</span></div>
<div class="line">    UART_Init();</div>
<div class="line"> </div>
<div class="line">    <span class="comment">/* Initialize the S2PI hardware required by the API. */</span></div>
<div class="line">    S2PI_Init(SPI_SLAVE, SPI_BAUD_RATE);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><a class="code" href="group__status.html#gaaabdaf7ee58ca7269bd4bf24efcde092">status_t</a> measurement_ready_callback(<a class="code" href="group__status.html#gaaabdaf7ee58ca7269bd4bf24efcde092">status_t</a> status, <span class="keywordtype">void</span> * data)</div>
<div class="line">{</div>
<div class="line">    <span class="keywordflow">if</span> (status != <a class="code" href="group__status.html#gga67a0db04d321a74b7e7fcfd3f1a3f70ba7e4a42e3b6dd63708c64cf3db6f69566">STATUS_OK</a>)</div>
<div class="line">    {</div>
<div class="line">        <span class="comment">/* Error Handling ...*/</span></div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">else</span></div>
<div class="line">    {</div>
<div class="line">        <span class="comment">/* Inform the main task about new data ready.</span></div>
<div class="line"><span class="comment">         * Note: do not call the evaluate measurement method</span></div>
<div class="line"><span class="comment">         * from within this callback since it is invoked in</span></div>
<div class="line"><span class="comment">         * a interrupt service routine and should return as</span></div>
<div class="line"><span class="comment">         * soon as possible. */</span></div>
<div class="line">        myData = data;</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">return</span> status;</div>
<div class="line">}</div>
<div class="ttc" id="aargus_8h_html"><div class="ttname"><a href="argus_8h.html">argus.h</a></div><div class="ttdoc">This file is part of the AFBR-S50 API.</div></div>
<div class="ttc" id="agroup__argus__log_html_gaf623b0ecc471d68c31c110c6f9abd7d2"><div class="ttname"><a href="group__argus__log.html#gaf623b0ecc471d68c31c110c6f9abd7d2">print</a></div><div class="ttdeci">status_t print(const char *fmt_s,...)</div><div class="ttdoc">A printf-like function to print formated data to an debugging interface.</div></div>
<div class="ttc" id="agroup__argusapi_html_ga0c81d41a6c8aecceca64b54c724b6a2d"><div class="ttname"><a href="group__argusapi.html#ga0c81d41a6c8aecceca64b54c724b6a2d">Argus_CreateHandle</a></div><div class="ttdeci">argus_hnd_t * Argus_CreateHandle(void)</div><div class="ttdoc">Creates a new device data handle object to store all internal states.</div></div>
<div class="ttc" id="agroup__argusapi_html_ga0ff472df08ed31ebbc16d3c6cf0c6564"><div class="ttname"><a href="group__argusapi.html#ga0ff472df08ed31ebbc16d3c6cf0c6564">argus_hnd_t</a></div><div class="ttdeci">void argus_hnd_t</div><div class="ttdef"><b>Definition:</b> argus_api.h:60</div></div>
<div class="ttc" id="agroup__argusapi_html_ga7d724a6657138f112bff554f7db2a898"><div class="ttname"><a href="group__argusapi.html#ga7d724a6657138f112bff554f7db2a898">Argus_Init</a></div><div class="ttdeci">status_t Argus_Init(argus_hnd_t *hnd, s2pi_slave_t spi_slave)</div><div class="ttdoc">Initializes the API modules and the device with default parameters.</div></div>
<div class="ttc" id="agroup__arguscfg_html_gaa6d970c42ac21e56907247f58a029472"><div class="ttname"><a href="group__arguscfg.html#gaa6d970c42ac21e56907247f58a029472">Argus_SetConfigurationFrameTime</a></div><div class="ttdeci">status_t Argus_SetConfigurationFrameTime(argus_hnd_t *hnd, uint32_t value)</div><div class="ttdoc">Sets the frame time to a specified device.</div></div>
<div class="ttc" id="agroup__argusmeas_html_ga39cbc3ebea33bbc497cadd393254c239"><div class="ttname"><a href="group__argusmeas.html#ga39cbc3ebea33bbc497cadd393254c239">Argus_EvaluateData</a></div><div class="ttdeci">status_t Argus_EvaluateData(argus_hnd_t *hnd, argus_results_t *res, void *raw)</div><div class="ttdoc">Evaluate useful information from the raw measurement data.</div></div>
<div class="ttc" id="agroup__argusmeas_html_ga92c7d4e2cdfccff38bf6689935e088a5"><div class="ttname"><a href="group__argusmeas.html#ga92c7d4e2cdfccff38bf6689935e088a5">Argus_TriggerMeasurement</a></div><div class="ttdeci">status_t Argus_TriggerMeasurement(argus_hnd_t *hnd, argus_callback_t cb)</div><div class="ttdoc">Triggers a single measurement frame asynchronously.</div></div>
<div class="ttc" id="agroup__argusmeas_html_gaa80d0b10b2366f0ade05b4d7b9243497"><div class="ttname"><a href="group__argusmeas.html#gaa80d0b10b2366f0ade05b4d7b9243497">Argus_GetStatus</a></div><div class="ttdeci">status_t Argus_GetStatus(argus_hnd_t *hnd)</div><div class="ttdoc">Checks the state of the device/driver.</div></div>
<div class="ttc" id="agroup__fixedpoint_html_gae92e284f44eb56820cf5a1d330ce4c0f"><div class="ttname"><a href="group__fixedpoint.html#gae92e284f44eb56820cf5a1d330ce4c0f">Q9_22_ONE</a></div><div class="ttdeci">#define Q9_22_ONE</div><div class="ttdef"><b>Definition:</b> fp_def.h:398</div></div>
<div class="ttc" id="agroup__status_html_gaaabdaf7ee58ca7269bd4bf24efcde092"><div class="ttname"><a href="group__status.html#gaaabdaf7ee58ca7269bd4bf24efcde092">status_t</a></div><div class="ttdeci">int32_t status_t</div><div class="ttdoc">Type used for all status and error return values.</div><div class="ttdef"><b>Definition:</b> argus_status.h:63</div></div>
<div class="ttc" id="agroup__status_html_gga67a0db04d321a74b7e7fcfd3f1a3f70ba27b7b4ca606d6208a2ada6df1af6ab88"><div class="ttname"><a href="group__status.html#gga67a0db04d321a74b7e7fcfd3f1a3f70ba27b7b4ca606d6208a2ada6df1af6ab88">STATUS_BUSY</a></div><div class="ttdeci">@ STATUS_BUSY</div><div class="ttdef"><b>Definition:</b> argus_status.h:82</div></div>
<div class="ttc" id="agroup__status_html_gga67a0db04d321a74b7e7fcfd3f1a3f70ba3ec68d249b5ffaa0da7e0a1170f592a2"><div class="ttname"><a href="group__status.html#gga67a0db04d321a74b7e7fcfd3f1a3f70ba3ec68d249b5ffaa0da7e0a1170f592a2">STATUS_ARGUS_POWERLIMIT</a></div><div class="ttdeci">@ STATUS_ARGUS_POWERLIMIT</div><div class="ttdef"><b>Definition:</b> argus_status.h:160</div></div>
<div class="ttc" id="agroup__status_html_gga67a0db04d321a74b7e7fcfd3f1a3f70ba7e4a42e3b6dd63708c64cf3db6f69566"><div class="ttname"><a href="group__status.html#gga67a0db04d321a74b7e7fcfd3f1a3f70ba7e4a42e3b6dd63708c64cf3db6f69566">STATUS_OK</a></div><div class="ttdeci">@ STATUS_OK</div><div class="ttdef"><b>Definition:</b> argus_status.h:73</div></div>
<div class="ttc" id="astructargus__results__bin__t_html_a830e9e333b9fece506f2e72b92087a51"><div class="ttname"><a href="structargus__results__bin__t.html#a830e9e333b9fece506f2e72b92087a51">argus_results_bin_t::Range</a></div><div class="ttdeci">q9_22_t Range</div><div class="ttdef"><b>Definition:</b> argus_res.h:71</div></div>
<div class="ttc" id="astructargus__results__t_html"><div class="ttname"><a href="structargus__results__t.html">argus_results_t</a></div><div class="ttdoc">The measurement results data structure.</div><div class="ttdef"><b>Definition:</b> argus_res.h:141</div></div>
<div class="ttc" id="astructargus__results__t_html_aff9b50b61955470fa1d349b4fb17ff1e"><div class="ttname"><a href="structargus__results__t.html#aff9b50b61955470fa1d349b4fb17ff1e">argus_results_t::Bin</a></div><div class="ttdeci">argus_results_bin_t Bin</div><div class="ttdef"><b>Definition:</b> argus_res.h:167</div></div>
</div><!-- fragment --><h1><a class="anchor" id="gs_adv_example"></a>
Advanced Example</h1>
<p>Here is an example of how to use the API with the autonomous measurement triggering. The 1D range value of the obtained measurement data is streamed via an UART connection. Open a terminal (e.g. <a href="https://www.compuphase.com/software_termite.htm">Termite</a>) and open a UART connection using 115200 bps, 8N1, no handshake connection. Range values will start to occur on the terminal as soon as the program starts its execution.</p>
<div class="fragment"><div class="line"><span class="comment">/*******************************************************************************</span></div>
<div class="line"><span class="comment"> * Include Files</span></div>
<div class="line"><span class="comment"> ******************************************************************************/</span></div>
<div class="line"><span class="preprocessor">#include &quot;<a class="code" href="argus_8h.html">argus.h</a>&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;board/clock_config.h&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;driver/cop.h&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;driver/gpio.h&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;driver/s2pi.h&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;driver/uart.h&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;driver/timer.h&quot;</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">/*******************************************************************************</span></div>
<div class="line"><span class="comment"> * Defines</span></div>
<div class="line"><span class="comment"> ******************************************************************************/</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#define ADVANCED_DEMO 1</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#define SPI_SLAVE 1</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#define SPI_BAUD_RATE 6000000</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">/*******************************************************************************</span></div>
<div class="line"><span class="comment"> * Variables</span></div>
<div class="line"><span class="comment"> ******************************************************************************/</span></div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keyword">volatile</span> <span class="keywordtype">void</span> * myData = 0;</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="comment">/*******************************************************************************</span></div>
<div class="line"><span class="comment"> * Prototypes</span></div>
<div class="line"><span class="comment"> ******************************************************************************/</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">/*!***************************************************************************</span></div>
<div class="line"><span class="comment"> * @brief   printf-like function to send print messages via UART.</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> * @details Defined in &quot;driver/uart.c&quot; source file.</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> *          Open an UART connection with 115200 bps, 8N1, no handshake to</span></div>
<div class="line"><span class="comment"> *          receive the data on a computer.</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> * @param   fmt_s : The usual printf parameters.</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> * @return  Returns the \link #status_t status\endlink (#STATUS_OK on success).</span></div>
<div class="line"><span class="comment"> *****************************************************************************/</span></div>
<div class="line"><span class="keyword">extern</span> <a class="code" href="group__status.html#gaaabdaf7ee58ca7269bd4bf24efcde092">status_t</a> <a class="code" href="group__argus__log.html#gaf623b0ecc471d68c31c110c6f9abd7d2">print</a>(<span class="keyword">const</span> <span class="keywordtype">char</span>  *fmt_s, ...);</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="comment">/*!***************************************************************************</span></div>
<div class="line"><span class="comment"> * @brief   Initialization routine for board hardware and peripherals.</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> * @return  -</span></div>
<div class="line"><span class="comment"> *****************************************************************************/</span></div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> hardware_init(<span class="keywordtype">void</span>);</div>
<div class="line"> </div>
<div class="line"><span class="comment">/*!***************************************************************************</span></div>
<div class="line"><span class="comment"> * @brief   Measurement data ready callback function.</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> * @details</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> * @param   status :</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> * @param   data :</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> * @return  Returns the \link #status_t status\endlink (#STATUS_OK on success).</span></div>
<div class="line"><span class="comment"> *****************************************************************************/</span></div>
<div class="line"><a class="code" href="group__status.html#gaaabdaf7ee58ca7269bd4bf24efcde092">status_t</a> measurement_ready_callback(<a class="code" href="group__status.html#gaaabdaf7ee58ca7269bd4bf24efcde092">status_t</a> status, <span class="keywordtype">void</span> * data);</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="comment">/*******************************************************************************</span></div>
<div class="line"><span class="comment"> * Code</span></div>
<div class="line"><span class="comment"> ******************************************************************************/</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">/*!***************************************************************************</span></div>
<div class="line"><span class="comment"> * @brief   Application entry point.</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> * @details The main function of the program, called after startup code</span></div>
<div class="line"><span class="comment"> *          This function should never be exited.</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> * @return  -</span></div>
<div class="line"><span class="comment"> *****************************************************************************/</span></div>
<div class="line"><span class="keywordtype">int</span> main(<span class="keywordtype">void</span>)</div>
<div class="line">{</div>
<div class="line">    <span class="comment">/* The API module handle that contains all data definitions that is</span></div>
<div class="line"><span class="comment">     * required within the API module for the corresponding hardware device.</span></div>
<div class="line"><span class="comment">     * Every call to an API function requires the passing of a pointer to this</span></div>
<div class="line"><span class="comment">     * data structure. */</span></div>
<div class="line">    <a class="code" href="group__argusapi.html#ga0ff472df08ed31ebbc16d3c6cf0c6564">argus_hnd_t</a> * hnd = <a class="code" href="group__argusapi.html#ga0c81d41a6c8aecceca64b54c724b6a2d">Argus_CreateHandle</a>();</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (hnd == 0)</div>
<div class="line">    {</div>
<div class="line">        <span class="comment">/* Error Handling ...*/</span></div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="comment">/* Initialize the platform hardware including the required peripherals</span></div>
<div class="line"><span class="comment">     * for the API. */</span></div>
<div class="line">    hardware_init();</div>
<div class="line"> </div>
<div class="line">    <span class="comment">/* Initialize the API with default values.</span></div>
<div class="line"><span class="comment">     * This implicitly calls the initialization functions</span></div>
<div class="line"><span class="comment">     * of the underlying API modules.</span></div>
<div class="line"><span class="comment">     *</span></div>
<div class="line"><span class="comment">     * The second parameter is stored and passed to all function calls</span></div>
<div class="line"><span class="comment">     * to the S2PI module. This piece of information can be utilized in</span></div>
<div class="line"><span class="comment">     * order to determine the addressed SPI slave and enabled the usage</span></div>
<div class="line"><span class="comment">     * of multiple devices on a single SPI peripheral. */</span></div>
<div class="line">    <a class="code" href="group__status.html#gaaabdaf7ee58ca7269bd4bf24efcde092">status_t</a> status = <a class="code" href="group__argusapi.html#ga7d724a6657138f112bff554f7db2a898">Argus_Init</a>(hnd, SPI_SLAVE);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (status != <a class="code" href="group__status.html#gga67a0db04d321a74b7e7fcfd3f1a3f70ba7e4a42e3b6dd63708c64cf3db6f69566">STATUS_OK</a>)</div>
<div class="line">    {</div>
<div class="line">        <span class="comment">/* Error Handling ...*/</span></div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="comment">/* Adjust some configuration parameters by invoking the dedicated API methods. */</span></div>
<div class="line">    <a class="code" href="group__arguscfg.html#gaa6d970c42ac21e56907247f58a029472">Argus_SetConfigurationFrameTime</a>(hnd, 100000); <span class="comment">// 0.1 second = 10 Hz</span></div>
<div class="line"> </div>
<div class="line">    <span class="comment">/* Start the measurement timers within the API module.</span></div>
<div class="line"><span class="comment">     * The callback is invoked every time a measurement has been finished.</span></div>
<div class="line"><span class="comment">     * The callback is used to schedule the data evaluation routine to the</span></div>
<div class="line"><span class="comment">     * main thread by the user.</span></div>
<div class="line"><span class="comment">     * Note that the timer based measurement is not implemented for multiple</span></div>
<div class="line"><span class="comment">     * instance yet! */</span></div>
<div class="line">    status = <a class="code" href="group__argusmeas.html#gae1682b01c1ed1b837fd7d763d81e857c">Argus_StartMeasurementTimer</a>(hnd, measurement_ready_callback);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (status != <a class="code" href="group__status.html#gga67a0db04d321a74b7e7fcfd3f1a3f70ba7e4a42e3b6dd63708c64cf3db6f69566">STATUS_OK</a>)</div>
<div class="line">    {</div>
<div class="line">        <span class="comment">/* Error Handling ...*/</span></div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">for</span>(;;)</div>
<div class="line">    {</div>
<div class="line">        <span class="comment">/* Check if new measurement data is ready. */</span></div>
<div class="line">        <span class="keywordflow">if</span>(myData != 0)</div>
<div class="line">        {</div>
<div class="line">            <span class="comment">/* Release for next measurement data. */</span></div>
<div class="line">            <span class="keywordtype">void</span> * data = (<span class="keywordtype">void</span> *) myData;</div>
<div class="line">            myData = 0;</div>
<div class="line"> </div>
<div class="line">            <span class="comment">/* The measurement data structure. */</span></div>
<div class="line">            <a class="code" href="structargus__results__t.html">argus_results_t</a> res;</div>
<div class="line"> </div>
<div class="line">            <span class="comment">/* Evaluate the raw measurement results. */</span></div>
<div class="line">            status = <a class="code" href="group__argusmeas.html#ga39cbc3ebea33bbc497cadd393254c239">Argus_EvaluateData</a>(hnd, &amp;res, data);</div>
<div class="line"> </div>
<div class="line">            <span class="keywordflow">if</span> (status != <a class="code" href="group__status.html#gga67a0db04d321a74b7e7fcfd3f1a3f70ba7e4a42e3b6dd63708c64cf3db6f69566">STATUS_OK</a>)</div>
<div class="line">            {</div>
<div class="line">                <span class="comment">/* Error Handling ...*/</span></div>
<div class="line">            }</div>
<div class="line"> </div>
<div class="line">            <span class="keywordflow">else</span></div>
<div class="line">            {</div>
<div class="line">                <span class="comment">/* Use the recent measurement results</span></div>
<div class="line"><span class="comment">                 * (converting the Q9.22 value to float and print or display it). */</span></div>
<div class="line">                <a class="code" href="group__argus__log.html#gaf623b0ecc471d68c31c110c6f9abd7d2">print</a>(<span class="stringliteral">&quot;Range: %d mm\n&quot;</span>, res.<a class="code" href="structargus__results__t.html#aff9b50b61955470fa1d349b4fb17ff1e">Bin</a>.<a class="code" href="structargus__results__bin__t.html#a830e9e333b9fece506f2e72b92087a51">Range</a> / (<a class="code" href="group__fixedpoint.html#gae92e284f44eb56820cf5a1d330ce4c0f">Q9_22_ONE</a> / 1000));</div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="line">        <span class="keywordflow">else</span></div>
<div class="line">        {</div>
<div class="line">            <span class="comment">/* User code here... */</span></div>
<div class="line">            __asm(<span class="stringliteral">&quot;nop&quot;</span>);</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> hardware_init(<span class="keywordtype">void</span>)</div>
<div class="line">{</div>
<div class="line">    <span class="comment">/* Initialize the board with clocks. */</span></div>
<div class="line">    BOARD_ClockInit();</div>
<div class="line"> </div>
<div class="line">    <span class="comment">/* Disable the watchdog timer. */</span></div>
<div class="line">    COP_Disable();</div>
<div class="line"> </div>
<div class="line">    <span class="comment">/* Init GPIO ports. */</span></div>
<div class="line">    GPIO_Init();</div>
<div class="line"> </div>
<div class="line">    <span class="comment">/* Initialize timer required by the API. */</span></div>
<div class="line">    Timer_Init();</div>
<div class="line"> </div>
<div class="line">    <span class="comment">/* Initialize UART for print functionality. */</span></div>
<div class="line">    UART_Init();</div>
<div class="line"> </div>
<div class="line">    <span class="comment">/* Initialize the S2PI hardware required by the API. */</span></div>
<div class="line">    S2PI_Init(SPI_SLAVE, SPI_BAUD_RATE);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><a class="code" href="group__status.html#gaaabdaf7ee58ca7269bd4bf24efcde092">status_t</a> measurement_ready_callback(<a class="code" href="group__status.html#gaaabdaf7ee58ca7269bd4bf24efcde092">status_t</a> status, <span class="keywordtype">void</span> * data)</div>
<div class="line">{</div>
<div class="line">    <span class="keywordflow">if</span> (status != <a class="code" href="group__status.html#gga67a0db04d321a74b7e7fcfd3f1a3f70ba7e4a42e3b6dd63708c64cf3db6f69566">STATUS_OK</a>)</div>
<div class="line">    {</div>
<div class="line">        <span class="comment">/* Error Handling ...*/</span></div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">else</span></div>
<div class="line">    {</div>
<div class="line">        <span class="comment">/* Inform the main task about new data ready.</span></div>
<div class="line"><span class="comment">         * Note: do not call the evaluate measurement method</span></div>
<div class="line"><span class="comment">         * from within this callback since it is invoked in</span></div>
<div class="line"><span class="comment">         * a interrupt service routine and should return as</span></div>
<div class="line"><span class="comment">         * soon as possible. */</span></div>
<div class="line">        myData = data;</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">return</span> status;</div>
<div class="line">}</div>
<div class="ttc" id="agroup__argusmeas_html_gae1682b01c1ed1b837fd7d763d81e857c"><div class="ttname"><a href="group__argusmeas.html#gae1682b01c1ed1b837fd7d763d81e857c">Argus_StartMeasurementTimer</a></div><div class="ttdeci">status_t Argus_StartMeasurementTimer(argus_hnd_t *hnd, argus_callback_t cb)</div><div class="ttdoc">Starts the timer based measurement cycle asynchronously.</div></div>
</div><!-- fragment --><h1><a class="anchor" id="gs_mcuxpresso"></a>
Build And Run the Examples using MCUXpresso</h1>
<p>In order to run the provided example projects using the MCUXpressIDE by NXP, execute the following steps. Please also refer to the getting started guide by NXP in case of any trouble: <a href="https://www.nxp.com/docs/en/user-guide/MCUXSDKGSUG.pdf">https://www.nxp.com/docs/en/user-guide/MCUXSDKGSUG.pdf</a></p>
<ul>
<li>Download and install the MCUXpresso IDE (recommended v11.1):<ul>
<li>Go to <a href="https://www.nxp.com/design/software/development-software/mcuxpresso-software-and-tools/mcuxpresso-integrated-development-environment-ide:MCUXpresso-IDE">https://www.nxp.com/design/software/development-software/mcuxpresso-software-and-tools/mcuxpresso-integrated-development-environment-ide:MCUXpresso-IDE</a></li>
<li>Click on <em>Download</em> and register or sign in to download the installer.</li>
<li>Install the IDE.</li>
<li>Go to <a href="https://mcuxpresso.nxp.com">https://mcuxpresso.nxp.com</a> for more information.</li>
</ul>
</li>
<li><p class="startli">Download and import the KL46z SDK into the MCUXpresso IDE v11.1 <br  />
</p><ul>
<li>Open MCUXpressIDE, accept the workspace settings by clicking on "Launch".</li>
<li>Click on "Download and Install SDKs" on the "Welcome Page".</li>
<li>Go to the "Processors" tab and type "MKL46" into the filter field, select the "SDK_2.x_MKL46Z256xxx4" SDK and click "Install".</li>
<li>Accepot the licenses and click on "Finish".</li>
<li>After the installation has finished, close the "Welcome" view.</li>
</ul>
<div class="image">
<img src="3_1_install_sdk.jpg" alt="" width="800px"/>
<div class="caption">
Fig. 3.1: Download and install the SDK files into the MCUXpresso IDE.</div></div>
 </li>
<li><p class="startli">Import the project archive files:</p><ul>
<li>Go to MCUXpresso IDE -&gt; Quickstart Panel</li>
<li>Click on "Import projects(s) from file system..."</li>
<li>Click on "Browse..." in the Archive section</li>
<li>Browse to "[INSTALL_DIR]\Device\Projects\" (default is "C:\Program Files (x86)\Broadcom\AFBR-S50 SDK\Device\Projects\"</li>
<li>Select the required project archive ("*AFBR_S50_Example_KL46z.zip*") and click "Open"</li>
<li>Click on "Next" -&gt; "Finish"</li>
</ul>
<div class="image">
<img src="3_2_import_project.jpg" alt="" width="800px"/>
<div class="caption">
Fig. 3.2: Import the project archive into the MCUXpresso IDE.</div></div>
 </li>
<li><p class="startli">Build the projects:</p><ul>
<li>Go to MCUXpresso IDE -&gt; Quickstart Panel</li>
<li>Click on "Build"</li>
</ul>
<div class="image">
<img src="3_3_build.jpg" alt="" width="800px"/>
<div class="caption">
Fig. 3.3: Build the project.</div></div>
 </li>
<li>Download and install the OpenSDA drivers:<ul>
<li>Go to <a href="http://www.pemicro.com/opensda/">http://www.pemicro.com/opensda/</a></li>
<li>Download and install <em>PEDrivers_install.exe</em></li>
</ul>
</li>
<li><p class="startli">Debug and run the project with the OpenSDA debugger:</p><ul>
<li>Connect the <em>OpenSDA</em> USB port of the KL46z evaluation board.</li>
<li>Go to MCUXpresso IDE -&gt; Quickstart Panel</li>
<li>Click in the PEMicro Icon (see screenshot).</li>
<li>The Debug Probe will be discovered and an according window will show.</li>
<li>Click on "OK"</li>
</ul>
<div class="image">
<img src="3_4_debug.jpg" alt="" width="800px"/>
<div class="caption">
Fig. 3.4: Run and debug the project.</div></div>
 <ul>
<li>If the program breaks at the main() function, hit the "Resume" button.</li>
</ul>
<div class="image">
<img src="3_5_debug_resume.jpg" alt="" width="800px"/>
<div class="caption">
Fig. 3.5: Resume the halted program.</div></div>
 </li>
<li><p class="startli">Display the measurement values on a PC via an UART terminal:</p><ul>
<li>Open a terminal (e.g. <a href="https://www.compuphase.com/software_termite.htm">Termite</a>) and open a UART connection using 115200 bps, 8N1, no handshake connection.</li>
</ul>
<div class="image">
<img src="3_6_terminal_settings.jpg" alt="" width="600px"/>
<div class="caption">
Fig. 3.6: Setting up the terminal to receive measurement results.</div></div>
 <ul>
<li>Range values will start to occur on the terminal as soon as the program starts its execution.</li>
</ul>
<div class="image">
<img src="3_7_terminal.jpg" alt="" width="600px"/>
<div class="caption">
Fig. 3.7: The serial terminal is used to display the received measurement results.</div></div>
 </li>
</ul>
<p>The example application is now up and running. It is a simple program that executes measurements and displays the 1D distance (Units: millimeter) value on the terminal. See also the <a href="#gs_api">AFBR-S50 API</a> section for a brief description.</p>
<p>The evaluation kit is build on the FRDM-KL46z Evaluation Kit from NXP. So you may also refer <a href="https://www.nxp.com/frdm-kl46z">https://www.nxp.com/frdm-kl46z</a> for further information.</p>
<h1><a class="anchor" id="gs_troubleshooting"></a>
Troubleshooting</h1>
<h2><a class="anchor" id="autotoc_md4"></a>
Error -101 (Device Not Connected)</h2>
<p>Problem: After calling the <a class="el" href="group__argusapi.html#ga7d724a6657138f112bff554f7db2a898" title="Initializes the API modules and the device with default parameters.">Argus_Init()</a> method, an error status -101 (<a class="el" href="group__status.html#gga67a0db04d321a74b7e7fcfd3f1a3f70baa1e50bb51331e898a5b3a6662a770016">ERROR_ARGUS_NOT_CONNECTED</a>) is returned.</p>
<p>The first thing that happens in the initialization function are a few read/write cycles on the SPI interface in order to check the responsiveness of the device: first, a byte sequence (1,2,3,4,...,15) is written to the MOSI and the MISO data is ignored. Second, a sequence of 0's is written to the same register and the MISO is captured and compared to the pattern from the previous write cycle. Finally, another sequence of 0's is written and the received data is checked for being zero again. If the read pattern is not equal to the written one, the error <a class="el" href="group__status.html#gga67a0db04d321a74b7e7fcfd3f1a3f70baa1e50bb51331e898a5b3a6662a770016">ERROR_ARGUS_NOT_CONNECTED</a> is returned and the initialization process is canceled.</p>
<p>In order to solve the issue, verify the following sequence in your SPI interface when calling the <a class="el" href="group__argusapi.html#ga7d724a6657138f112bff554f7db2a898" title="Initializes the API modules and the device with default parameters.">Argus_Init()</a> function:</p>
<ol type="1">
<li>Writing a test pattern to register address 0x04:<ul>
<li>MOSI: 0x 04 00 01 02 03 04 05 06 07 08 09 0A 0B 0C 0D 0E 0F</li>
<li>MISO: 0x 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 (or any other, depending on the current state of your device)</li>
</ul>
</li>
</ol>
<ol type="1">
<li>Clearing the test pattern at register 0x04, read back of test pattern 1:<ul>
<li>MOSI: 0x 04 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00</li>
<li>MISO : 0x 00 00 01 02 03 04 05 06 07 08 09 0A 0B 0C 0D 0E 0F</li>
</ul>
</li>
</ol>
<ol type="1">
<li>Clearing the test pattern at register 0x04, read back of test pattern 2:<ul>
<li>MOSI: 0x 04 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00</li>
<li>MISO: 0x 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00</li>
</ul>
</li>
</ol>
<p>Further check if the "spi_slave" parameter in the <a class="el" href="group__argusapi.html#ga7d724a6657138f112bff554f7db2a898" title="Initializes the API modules and the device with default parameters.">Argus_Init</a> function is not 0! This is reserved for error handling.</p>
<p>Please find the example files in "[INSTALL_DIR]\Device\Examples\" (default is "C:\Program Files (x86)\Broadcom\AFBR-S50 SDK\Device\Examples\"). </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- HTML footer for doxygen 1.8.13-->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
	<ul>
		<li class="footer">
            <a href="https://www.broadcom.com/">Broadcom Inc.</a>
		</li>
	</ul>
</div>
</body>
</html>