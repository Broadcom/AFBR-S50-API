<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>AFBR-S50 API Reference Manual: Getting Started</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
</script>
<script type="text/javascript" async="async" src="https://cdn.jsdelivr.net/npm/mathjax@2/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="style.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="AFBR-S50.ico"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">AFBR-S50 API Reference Manual
   &#160;<span id="projectnumber">v1.3.5</span>
   </div>
   <div id="projectbrief">AFBR-S50 Time-of-Flight Sensor SDK for Embedded Software</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('getting_started.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Getting Started </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="md_Doxygen_03_getting_started"></a> The following section gives an brief overview on of the <b>AFBR-S50 Core Library and API</b> and shows how to get started using the evaluation platform and example files. If a port to another microcontroller platform is required, refer to the <a class="el" href="porting_guide.html">Porting Guide</a>.</p>
<h1><a class="anchor" id="gs_api"></a>
AFBR-S50 API</h1>
<dl class="section note"><dt>Note</dt><dd>All <b>AFBR-S50 API</b> related functions, definitions and constants have a prefix <code>Argus</code> which is essentially an alias or working title for the <b>AFBR-S50 Time-of-Flight Sensor</b> device.</dd></dl>
<p>The <em>AFBR-S50 Core Library</em> is provided as a static ANSI-C library file ("lib*.a") and the corresponding API is provided as ANSI-C header files ("*.h"). After setting up the linker to link the library, it is sufficient to include the main header in the "/include" folder, "argus.h": </p><div class="fragment"><div class="line">#include &quot;argus.h&quot;</div>
</div><!-- fragment --><p>The API utilizes an abstract handler object that contains all internal states for a single time-of-flight sensor device. In this way, it is possible to use the same API with more than a single device. Note, however, that this feature is not fully implemented in the current version and is planned for a future release! After including the header file, the handler object must be created by calling the <a class="el" href="group__argusapi.html#ga0c81d41a6c8aecceca64b54c724b6a2d" title="Creates a new device data handle object to store all internal states.">Argus_CreateHandle</a> function to obtain a pointer to the newly allocated object. This is done via the standard library function: </p><div class="fragment"><div class="line">void * malloc(size_t size) </div>
</div><!-- fragment --><p> If it is required to use a different function, create and overwrite the weakly linked method and implement your own memory allocation algorithm: </p><div class="fragment"><div class="line">void * Argus_Malloc(size_t size) { /* ... */ } </div>
</div><!-- fragment --><p>After creation of the handler object, the <em>AFBR-S50</em> module must be initialized with the corresponding handler object: </p><div class="fragment"><div class="line">status_t status = Argus_Init(hnd, SPI_SLAVE); </div>
</div><!-- fragment --><p>Note that all peripheral modules must be ready to be used before executing any API function. So make sure to initialize the board and its peripherals before initializing the API via <code>Argus_Init</code>.</p>
<p>After calling <code>Argus_Init</code>, the device is ready to run and has been setup with default configuration and calibration data. Use the provided API functions to customize the given default configuration to the needs and requirements of the application.</p>
<p>Note that <code>Argus_Init</code> returns <a class="el" href="group__status.html#gga67a0db04d321a74b7e7fcfd3f1a3f70ba7e4a42e3b6dd63708c64cf3db6f69566">STATUS_OK</a> on successful initialization. In case of any non-zero return value, refer to the <a class="el" href="faq.html">Troubleshooting</a> section</p>
<p>There are two possibilities to operate the device. First, the simple polling method. The measurements are triggered by the main program via calling the <a class="el" href="group__argusmeas.html#ga92c7d4e2cdfccff38bf6689935e088a5" title="Triggers a single measurement frame asynchronously.">Argus_TriggerMeasurement</a> function any time a new measurement should be started. A new measurement frame is started and after reading the data from the device, the callback is invoked to inform the host application about the data ready event. In the meantime, the host application can poll the module status or execute other tasks. After finishing the measurement, the <a class="el" href="group__argusmeas.html#ga39cbc3ebea33bbc497cadd393254c239" title="Evaluate useful information from the raw measurement data.">Argus_EvaluateData</a> function must be called to obtain measurement data like range from the raw readout data. It is mandatory to call the evaluation method. Otherwise, the raw data buffer is kept occupied and no new measurements can be triggered anymore. The module contains a double buffer architecture, which allows to start the next measurement and evaluate the current measurement data while the device already executes the next measurement frame. After evaluation, the <a class="el" href="structargus__results__t.html" title="The measurement results data structure.">argus_results_t</a> data structure is filled with all measurement results that can be processed now be processed by the host application depending on the users needs. An example implementation is shown in the <a class="el" href="getting_started.html#gs_simple_example">Simple Example</a> section.</p>
<p>Please note that the laser safety module might refuse to restart a measurement at the time the function is called. This is due to timing constraints dictated by the laser safety rules. In this case, the function does return with <a class="el" href="group__status.html#gga67a0db04d321a74b7e7fcfd3f1a3f70ba3ec68d249b5ffaa0da7e0a1170f592a2">STATUS_ARGUS_POWERLIMIT</a> instead. Use the <a class="el" href="group__arguscfg.html#gaa6d970c42ac21e56907247f58a029472">frame time </a> and similar parameters to adjust the required pause times via the <a class="el" href="group__arguscfg.html">configuration API methods</a>.</p>
<p>The second way of operating the device is to leverage from an periodic interrupt time that invokes a callback to the API in periodic manner. The timer is implemented in the <a class="el" href="group__argus__timer.html">timer</a> interface. Instead of calling the trigger measurement function periodically from the host application, the measurement restarts itself in an autonomous way. Every time, a new raw measurement data set is ready, the measurement data ready callback is invoked by the API. Similar to the previous method, the <a class="el" href="group__argusmeas.html#ga39cbc3ebea33bbc497cadd393254c239" title="Evaluate useful information from the raw measurement data.">Argus_EvaluateData</a> function must be called before the data can be used. Note that not calling the function will lead to measurements are not restarted before the evaluation method is called and the data buffers is freed. In the same manner, a slow data evaluation or much user code to delay the data evaluation method might decrease the measurement frame rate. An example implementation is shown in the <a class="el" href="getting_started.html#gs_adv_example">Advanced Example</a> section.</p>
<h1><a class="anchor" id="gs_mcuxpresso"></a>
Build And Run the Examples using MCUXpresso</h1>
<p>In order to run the provided example projects using the <em>MCUXpresso IDE</em>, execute the following steps. Please also refer to the getting started guide by NXP in case of any trouble: <a href="https://www.nxp.com/docs/en/user-guide/MCUXSDKGSUG.pdf">https://www.nxp.com/docs/en/user-guide/MCUXSDKGSUG.pdf</a></p>
<dl class="section note"><dt>Note</dt><dd>Depending on where you obtain the code, i.e. from the SDK installer or the GitHub repository, certain steps may differ. The projects that come with the SDK installer (found at "[INSTALL_DIR]\Device\Projects\") are provided as zip-file and will be copied into the MCUXpresso workspace. The projects downloaded or cloned from the GitHub repository are already unpacked an must be imported but not copied into the MCUXpresso workspace (otherwise the project references become invalid).</dd></dl>
<p>In order to run provided project, execute the following steps:</p>
<ol type="1">
<li>Download and install the <em>MCUXpresso IDE</em> (recommended v11.3 or higher):<ol type="a">
<li>Go to <a href="https://www.nxp.com/design/software/development-software/mcuxpresso-software-and-tools/mcuxpresso-integrated-development-environment-ide:MCUXpresso-IDE">https://www.nxp.com/design/software/development-software/mcuxpresso-software-and-tools/mcuxpresso-integrated-development-environment-ide:MCUXpresso-IDE</a></li>
<li>Click on <em>Download</em> and register or sign in to download the installer.</li>
<li>Install the IDE.</li>
<li>Go to <a href="https://mcuxpresso.nxp.com">https://mcuxpresso.nxp.com</a> for more information.</li>
</ol>
</li>
<li><p class="startli">Download and import the KL46z SDK into the MCUXpresso IDE v11.3</p><ol type="a">
<li>Open MCUXpresso IDE, accept the workspace settings by clicking on "Launch".</li>
<li>Click on "Download and Install SDKs" on the "Welcome Page".</li>
<li>Go to the "Processors" tab and type "MKL46" into the filter field, select the "SDK_2.x_MKL46Z256xxx4" SDK and click "Install".</li>
<li>Accept the licenses and click on "Finish".</li>
<li>After the installation has finished, close the "Welcome" view.</li>
</ol>
<div class="image">
<img src="3_1_install_sdk.jpg" alt="" width="800px"/>
<div class="caption">
Fig. 3.1: Download and install the SDK files into the MCUXpresso IDE.</div></div>
 </li>
<li><p class="startli">Import the project archive files:</p><ol type="a">
<li>Go to MCUXpresso IDE -&gt; Quickstart Panel</li>
<li>Click on "Import projects(s) from file system..."</li>
<li>Select your project for import:<ul>
<li>If importing a project as zip file as provided by the SDK installer:<ul>
<li>Click on "Browse..." in the "Project archive (zip)" section</li>
<li>Browse to "[INSTALL_DIR]\Device\Projects\" (default is "C:\Program Files (x86)\Broadcom\AFBR-S50 SDK\Device\Projects\"</li>
<li>Select the required project archive (e.g. "*AFBR_S50_Example_KL46z.zip*") and click "Open"</li>
</ul>
</li>
<li><p class="startli">If importing a project from the local directory as provided by cloning/downloading the GitHub repository:</p><ul>
<li>Click on "Browse..." in the "Project directory (unpacked)" section</li>
<li>Browse to "[REPOSITORY_ROOT]\Projects\MCUXpresso\"</li>
<li>Select the required project root folder (e.g. "*AFBR_S50_Example_KL46z*") and click "Select Folder"</li>
<li><b>IMPORTANT</b>: Click "Next" and disable the check at "Copy projects into Workspace". (Otherwise, the references to the source files will be messed up!)</li>
</ul>
<div class="image">
<img src="3_2_disable_copy_into_ws.jpg" alt="" width="400px"/>
<div class="caption">
Fig. 3.3: Disable the check at "Copy projects into workspace" before importing an directory project!</div></div>
 </li>
</ul>
</li>
<li>Click "Finish"</li>
</ol>
<div class="image">
<img src="3_3_import_project.jpg" alt="" width="800px"/>
<div class="caption">
Fig. 3.3: Import the project archive into the MCUXpresso IDE.</div></div>
 </li>
<li><p class="startli">Build the projects:</p><ul>
<li>Go to MCUXpresso IDE -&gt; Project Explorer and select the project to build.</li>
<li>Go to Quickstart Panel and click on "Build"</li>
</ul>
<div class="image">
<img src="3_4_build.jpg" alt="" width="800px"/>
<div class="caption">
Fig. 3.4: Build the project.</div></div>
 </li>
<li>Download and install the OpenSDA drivers:<ul>
<li>Go to <a href="http://www.pemicro.com/opensda/">http://www.pemicro.com/opensda/</a></li>
<li>Download and install <em>PEDrivers_install.exe</em></li>
</ul>
</li>
<li><p class="startli">Debug and run the project with the OpenSDA debugger:</p><ul>
<li>Connect the <em>OpenSDA</em> USB port of the KL46z evaluation board.</li>
<li>Go to MCUXpresso IDE -&gt; Quickstart Panel</li>
<li>Click in the PEMicro Icon (see screenshot).</li>
<li>The Debug Probe will be discovered and an according window will show.</li>
<li>Click on "OK"</li>
</ul>
<div class="image">
<img src="3_5_debug.jpg" alt="" width="800px"/>
<div class="caption">
Fig. 3.5: Run and debug the project.</div></div>
 <ul>
<li>If the program breaks at the main() function, hit the "Resume" button.</li>
</ul>
<div class="image">
<img src="3_6_debug_resume.jpg" alt="" width="800px"/>
<div class="caption">
Fig. 3.6: Resume the halted program.</div></div>
 </li>
<li><p class="startli">Display the measurement values on a PC via an UART terminal:</p><ul>
<li>Open a terminal (e.g. <a href="https://www.compuphase.com/software_termite.htm">Termite</a>) and open a UART connection using 115200 bps, 8N1, no handshake connection.</li>
</ul>
<div class="image">
<img src="3_7_terminal_settings.jpg" alt="" width="600px"/>
<div class="caption">
Fig. 3.7: Setting up the terminal to receive measurement results.</div></div>
 <ul>
<li>Range values will start to occur on the terminal as soon as the program starts its execution.</li>
</ul>
<div class="image">
<img src="3_8_terminal.jpg" alt="" width="600px"/>
<div class="caption">
Fig. 3.8: The serial terminal is used to display the received measurement results.</div></div>
 </li>
</ol>
<p>The example application is now up and running. It is a simple program that executes measurements and displays the 1D distance (Units: millimeter) value on the terminal. See also the <a href="#gs_api">AFBR-S50 API</a> section for a brief description.</p>
<p>The evaluation kit is build on the FRDM-KL46z Evaluation Kit from NXP. So you may also refer <a href="https://www.nxp.com/frdm-kl46z">https://www.nxp.com/frdm-kl46z</a> for further information.</p>
<h1><a class="anchor" id="gs_simple_example"></a>
Simple Example</h1>
<p>Here is an example of how to use the API in a simple loop with polling the module status to wait for the measurement data to be ready. The 1D range value of the obtained measurement data is streamed via an UART connection. Open a terminal (e.g. <a href="https://www.compuphase.com/software_termite.htm">Termite</a>) and open a UART connection using 115200 bps, 8N1, no handshake connection. Range values will start to occur on the terminal as soon as the program starts its execution.</p>
<p>Please find the example files in "[INSTALL_DIR]\Device\Examples\" (default is "C:\Program Files (x86)\Broadcom\AFBR-S50 SDK\Device\Examples\").</p>
<div class="fragment"><div class="line"><span class="comment">/*************************************************************************/</span></div>
<div class="line"><span class="comment">/*******************************************************************************</span></div>
<div class="line"><span class="comment"> * Include Files</span></div>
<div class="line"><span class="comment"> ******************************************************************************/</span></div>
<div class="line"><span class="preprocessor">#include &quot;<a class="code" href="argus_8h.html">argus.h</a>&quot;</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &quot;board/clock_config.h&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;driver/cop.h&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;driver/s2pi.h&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;driver/uart.h&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;driver/timer.h&quot;</span></div>
<div class="line"><span class="preprocessor">#if defined(CPU_MKL46Z256VLL4) || defined(CPU_MKL17Z256VFM4)</span></div>
<div class="line"><span class="preprocessor">#elif defined(STM32F401xE)</span></div>
<div class="line"><span class="preprocessor">#include &quot;main.h&quot;</span></div>
<div class="line"><span class="preprocessor">#else</span></div>
<div class="line"><span class="preprocessor">#error No target specified!</span></div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="comment">/*******************************************************************************</span></div>
<div class="line"><span class="comment"> * Defines</span></div>
<div class="line"><span class="comment"> ******************************************************************************/</span></div>
<div class="line"><span class="preprocessor">#define SPI_SLAVE 1</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#define SPI_BAUD_RATE 6000000</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">/*******************************************************************************</span></div>
<div class="line"><span class="comment"> * Variables</span></div>
<div class="line"><span class="comment"> ******************************************************************************/</span></div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keyword">volatile</span> <span class="keywordtype">void</span> * myData = 0;</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="comment">/*******************************************************************************</span></div>
<div class="line"><span class="comment"> * Prototypes</span></div>
<div class="line"><span class="comment"> ******************************************************************************/</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">/*!***************************************************************************</span></div>
<div class="line"><span class="comment"> * @brief   printf-like function to send print messages via UART.</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> * @details Defined in &quot;driver/uart.c&quot; source file.</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> *          Open an UART connection with 115200 bps, 8N1, no handshake to</span></div>
<div class="line"><span class="comment"> *          receive the data on a computer.</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> * @param   fmt_s The usual printf parameters.</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> * @return  Returns the \link #status_t status\endlink (#STATUS_OK on success).</span></div>
<div class="line"><span class="comment"> *****************************************************************************/</span></div>
<div class="line"><span class="keyword">extern</span> <a class="code" href="group__status.html#gaaabdaf7ee58ca7269bd4bf24efcde092">status_t</a> <a class="code" href="group__argus__log.html#gaf623b0ecc471d68c31c110c6f9abd7d2">print</a>(<span class="keyword">const</span> <span class="keywordtype">char</span>  *fmt_s, ...);</div>
<div class="line"> </div>
<div class="line"><span class="comment">/*!***************************************************************************</span></div>
<div class="line"><span class="comment"> * @brief   Prints measurement results via UART.</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> * @details Prints some measurement data via UART in the following format:</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> *          Range: 123456 mm;  Amplitude: 1234 LSB  Status: 0</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> * @param   res A pointer to the latest measurement results structure.</span></div>
<div class="line"><span class="comment"> *****************************************************************************/</span></div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> print_results(<a class="code" href="structargus__results__t.html">argus_results_t</a> <span class="keyword">const</span> * res);</div>
<div class="line"> </div>
<div class="line"><span class="comment">/*!***************************************************************************</span></div>
<div class="line"><span class="comment"> * @brief   Initialization routine for board hardware and peripherals.</span></div>
<div class="line"><span class="comment"> *****************************************************************************/</span></div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> hardware_init(<span class="keywordtype">void</span>);</div>
<div class="line"> </div>
<div class="line"><span class="comment">/*!***************************************************************************</span></div>
<div class="line"><span class="comment"> * @brief   Measurement data ready callback function.</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> * @param   status The measurement/device status from the last measurement cycle.</span></div>
<div class="line"><span class="comment"> * @param   data A pointer to the raw measurement data results that need to be</span></div>
<div class="line"><span class="comment"> *               passed to the #Argus_EvaluateData function.</span></div>
<div class="line"><span class="comment"> * @return  Returns the \link #status_t status\endlink (#STATUS_OK on success).</span></div>
<div class="line"><span class="comment"> *****************************************************************************/</span></div>
<div class="line"><a class="code" href="group__status.html#gaaabdaf7ee58ca7269bd4bf24efcde092">status_t</a> measurement_ready_callback(<a class="code" href="group__status.html#gaaabdaf7ee58ca7269bd4bf24efcde092">status_t</a> status, <span class="keywordtype">void</span> * data);</div>
<div class="line"> </div>
<div class="line"><span class="comment">/*!***************************************************************************</span></div>
<div class="line"><span class="comment"> * @brief   A very brief example for error handling.</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> * @details Checks the specified status for errors (i.e. negative values) and</span></div>
<div class="line"><span class="comment"> *          prints a specified error message if any. An endless loop is entered</span></div>
<div class="line"><span class="comment"> *          to halt program execution.</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> * @param   status The specified status to be checked for errors.</span></div>
<div class="line"><span class="comment"> * @param   msg The associated error message to be printed in case of errors.</span></div>
<div class="line"><span class="comment"> *****************************************************************************/</span></div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> handle_error(<a class="code" href="group__status.html#gaaabdaf7ee58ca7269bd4bf24efcde092">status_t</a> status, <span class="keywordtype">char</span> <span class="keyword">const</span> * msg);</div>
<div class="line"> </div>
<div class="line"><span class="comment">/*******************************************************************************</span></div>
<div class="line"><span class="comment"> * Code</span></div>
<div class="line"><span class="comment"> ******************************************************************************/</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">/*!***************************************************************************</span></div>
<div class="line"><span class="comment"> * @brief   Application entry point.</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> * @details The main function of the program, called after startup code</span></div>
<div class="line"><span class="comment"> *          This function should never be exited.</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> * @return  Never returns anything...</span></div>
<div class="line"><span class="comment"> *****************************************************************************/</span></div>
<div class="line"><span class="keywordtype">int</span> main(<span class="keywordtype">void</span>)</div>
<div class="line">{</div>
<div class="line">    <a class="code" href="group__status.html#gaaabdaf7ee58ca7269bd4bf24efcde092">status_t</a> status = <a class="code" href="group__status.html#gga67a0db04d321a74b7e7fcfd3f1a3f70ba7e4a42e3b6dd63708c64cf3db6f69566">STATUS_OK</a>;</div>
<div class="line"> </div>
<div class="line">    <span class="comment">/* Initialize the platform hardware including the required peripherals</span></div>
<div class="line"><span class="comment">     * for the API. */</span></div>
<div class="line">    hardware_init();</div>
<div class="line"> </div>
<div class="line">    <span class="comment">/* The API module handle that contains all data definitions that is</span></div>
<div class="line"><span class="comment">     * required within the API module for the corresponding hardware device.</span></div>
<div class="line"><span class="comment">     * Every call to an API function requires the passing of a pointer to this</span></div>
<div class="line"><span class="comment">     * data structure. */</span></div>
<div class="line">    <a class="code" href="group__argusapi.html#ga0ff472df08ed31ebbc16d3c6cf0c6564">argus_hnd_t</a> * hnd = <a class="code" href="group__argusapi.html#ga0c81d41a6c8aecceca64b54c724b6a2d">Argus_CreateHandle</a>();</div>
<div class="line">    handle_error(hnd ? <a class="code" href="group__status.html#gga67a0db04d321a74b7e7fcfd3f1a3f70ba7e4a42e3b6dd63708c64cf3db6f69566">STATUS_OK</a> : <a class="code" href="group__status.html#gga67a0db04d321a74b7e7fcfd3f1a3f70ba841c3e4e3ac94c0005f107140e184276">ERROR_FAIL</a>, <span class="stringliteral">&quot;Argus_CreateHandle failed!&quot;</span>);</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">    <span class="comment">/* Initialize the API with default values.</span></div>
<div class="line"><span class="comment">     * This implicitly calls the initialization functions</span></div>
<div class="line"><span class="comment">     * of the underlying API modules.</span></div>
<div class="line"><span class="comment">     *</span></div>
<div class="line"><span class="comment">     * The second parameter is stored and passed to all function calls</span></div>
<div class="line"><span class="comment">     * to the S2PI module. This piece of information can be utilized in</span></div>
<div class="line"><span class="comment">     * order to determine the addressed SPI slave and enabled the usage</span></div>
<div class="line"><span class="comment">     * of multiple devices on a single SPI peripheral. */</span></div>
<div class="line">    status = <a class="code" href="group__argusapi.html#ga7d724a6657138f112bff554f7db2a898">Argus_Init</a>(hnd, SPI_SLAVE);</div>
<div class="line">    handle_error(status, <span class="stringliteral">&quot;Argus_Init failed!&quot;</span>);</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">    <span class="comment">/* Print some information about current API and connected device. */</span></div>
<div class="line">    uint32_t value = <a class="code" href="group__argusapi.html#gabec8f8d2fd8e05e1b4dc6158bffe1f23">Argus_GetAPIVersion</a>();</div>
<div class="line">    uint8_t a = (value &gt;&gt; 24) &amp; 0xFFU;</div>
<div class="line">    uint8_t b = (value &gt;&gt; 16) &amp; 0xFFU;</div>
<div class="line">    uint8_t c = value &amp; 0xFFFFU;</div>
<div class="line">    uint32_t <span class="keywordtype">id</span> = <a class="code" href="group__argusapi.html#ga809f5916407f49eebf87933cfed30e2d">Argus_GetChipID</a>(hnd);</div>
<div class="line">    <a class="code" href="group__argusapi.html#ga46f240b890cd62efe83bf2d095277470">argus_module_version_t</a> mv = <a class="code" href="group__argusapi.html#ga3f0b238436afb09796762fb47e9125b3">Argus_GetModuleVersion</a>(hnd);</div>
<div class="line">    <a class="code" href="group__argus__log.html#gaf623b0ecc471d68c31c110c6f9abd7d2">print</a>(<span class="stringliteral">&quot;\n##### AFBR-S50 API - Simple Example ##############\n&quot;</span></div>
<div class="line">          <span class="stringliteral">&quot;  API Version: v%d.%d.%d\n&quot;</span></div>
<div class="line">          <span class="stringliteral">&quot;  Chip ID:     %d\n&quot;</span></div>
<div class="line">          <span class="stringliteral">&quot;  Module:      %s\n&quot;</span></div>
<div class="line">          <span class="stringliteral">&quot;##################################################\n&quot;</span>,</div>
<div class="line">          a, b, c, <span class="keywordtype">id</span>,</div>
<div class="line">          mv == <a class="code" href="group__argusapi.html#gga46f240b890cd62efe83bf2d095277470aadb20086dac739d81b418ed885e13eac">AFBR_S50MV85G_V1</a> ? <span class="stringliteral">&quot;AFBR-S50MV85G (v1)&quot;</span> :</div>
<div class="line">          mv == <a class="code" href="group__argusapi.html#gga46f240b890cd62efe83bf2d095277470a2e11c996b63ce7373b0adfc0e7d2b054">AFBR_S50MV85G_V2</a> ? <span class="stringliteral">&quot;AFBR-S50MV85G (v2)&quot;</span> :</div>
<div class="line">          mv == <a class="code" href="group__argusapi.html#gga46f240b890cd62efe83bf2d095277470addaaf6b9cc172c456278d5d5038070f6">AFBR_S50MV85G_V3</a> ? <span class="stringliteral">&quot;AFBR-S50MV85G (v3)&quot;</span> :</div>
<div class="line">          mv == <a class="code" href="group__argusapi.html#gga46f240b890cd62efe83bf2d095277470a07a3ca0afd476a77d18af9cac7e8ca57">AFBR_S50LV85D_V1</a> ? <span class="stringliteral">&quot;AFBR-S50LV85D (v1)&quot;</span> :</div>
<div class="line">          mv == <a class="code" href="group__argusapi.html#gga46f240b890cd62efe83bf2d095277470a8c26ad1349762515f29bc9a417bbadbf">AFBR_S50MV68B_V1</a> ? <span class="stringliteral">&quot;AFBR-S50MV68B (v1)&quot;</span> :</div>
<div class="line">          mv == <a class="code" href="group__argusapi.html#gga46f240b890cd62efe83bf2d095277470a6623b6590854eddb5a65aad685e9800e">AFBR_S50MV85I_V1</a> ? <span class="stringliteral">&quot;AFBR-S50MV85I (v1)&quot;</span> :</div>
<div class="line">          mv == <a class="code" href="group__argusapi.html#gga46f240b890cd62efe83bf2d095277470ab844937ee93fb6b8a2c8446dd89fd3d4">AFBR_S50SV85K_V1</a> ? <span class="stringliteral">&quot;AFBR-S50SV85K (v1)&quot;</span> :</div>
<div class="line">          <span class="stringliteral">&quot;unknown&quot;</span>);</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">    <span class="comment">/* Adjust some configuration parameters by invoking the dedicated API methods. */</span></div>
<div class="line">    status = <a class="code" href="group__arguscfg.html#gaa6d970c42ac21e56907247f58a029472">Argus_SetConfigurationFrameTime</a>( hnd, 100000 ); <span class="comment">// 0.1 second = 10 Hz</span></div>
<div class="line">    handle_error(status, <span class="stringliteral">&quot;Argus_SetConfigurationFrameTime failed!&quot;</span>);</div>
<div class="line"> </div>
<div class="line">    <span class="comment">/* The program loop ... */</span></div>
<div class="line">    <span class="keywordflow">for</span> (;;)</div>
<div class="line">    {</div>
<div class="line">        myData = 0;</div>
<div class="line"> </div>
<div class="line">        <span class="comment">/* Triggers a single measurement.</span></div>
<div class="line"><span class="comment">         * Note that due to the laser safety algorithms, the method might refuse</span></div>
<div class="line"><span class="comment">         * to restart a measurement when the appropriate time has not been elapsed</span></div>
<div class="line"><span class="comment">         * right now. The function returns with status #STATUS_ARGUS_POWERLIMIT and</span></div>
<div class="line"><span class="comment">         * the function must be called again later. Use the frame time configuration</span></div>
<div class="line"><span class="comment">         * in order to adjust the timing between two measurement frames. */</span></div>
<div class="line">        status = <a class="code" href="group__argusmeas.html#ga92c7d4e2cdfccff38bf6689935e088a5">Argus_TriggerMeasurement</a>(hnd, measurement_ready_callback);</div>
<div class="line">        handle_error(status, <span class="stringliteral">&quot;Argus_StartMeasurementTimer failed!&quot;</span>);</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">if</span> (status == <a class="code" href="group__status.html#gga67a0db04d321a74b7e7fcfd3f1a3f70ba3ec68d249b5ffaa0da7e0a1170f592a2">STATUS_ARGUS_POWERLIMIT</a>)</div>
<div class="line">        {</div>
<div class="line">            <span class="comment">/* Not ready (due to laser safety) to restart the measurement yet.</span></div>
<div class="line"><span class="comment">             * Come back later. */</span></div>
<div class="line">            <span class="keywordflow">continue</span>;</div>
<div class="line">        }</div>
<div class="line">        <span class="keywordflow">else</span></div>
<div class="line">        {</div>
<div class="line">            <span class="comment">/* Wait until measurement data is ready. */</span></div>
<div class="line">            <span class="keywordflow">do</span></div>
<div class="line">            {</div>
<div class="line">                status = <a class="code" href="group__argusmeas.html#gaa80d0b10b2366f0ade05b4d7b9243497">Argus_GetStatus</a>(hnd);</div>
<div class="line">            }</div>
<div class="line">            <span class="keywordflow">while</span> (status == <a class="code" href="group__status.html#gga67a0db04d321a74b7e7fcfd3f1a3f70ba27b7b4ca606d6208a2ada6df1af6ab88">STATUS_BUSY</a>);</div>
<div class="line">            handle_error(status, <span class="stringliteral">&quot;Waiting for measurement data ready (Argus_GetStatus) failed!&quot;</span>);</div>
<div class="line"> </div>
<div class="line">            <span class="comment">/* The measurement data structure. */</span></div>
<div class="line">            <a class="code" href="structargus__results__t.html">argus_results_t</a> res;</div>
<div class="line"> </div>
<div class="line">            <span class="comment">/* Evaluate the raw measurement results. */</span></div>
<div class="line">            status = <a class="code" href="group__argusmeas.html#ga39cbc3ebea33bbc497cadd393254c239">Argus_EvaluateData</a>(hnd, &amp;res, (<span class="keywordtype">void</span>*) myData);</div>
<div class="line">            handle_error(status, <span class="stringliteral">&quot;Argus_EvaluateData failed!&quot;</span>);</div>
<div class="line"> </div>
<div class="line">            <span class="comment">/* Use the obtain results, e.g. print via UART. */</span></div>
<div class="line">            print_results(&amp;res);</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> print_results(<a class="code" href="structargus__results__t.html">argus_results_t</a> <span class="keyword">const</span> * res)</div>
<div class="line">{</div>
<div class="line">    <span class="comment">/* Print the recent measurement results:</span></div>
<div class="line"><span class="comment">     * 1. Range in mm (converting the Q9.22 value to mm)</span></div>
<div class="line"><span class="comment">     * 2. Amplitude in LSB (converting the UQ12.4 value to LSB)</span></div>
<div class="line"><span class="comment">     * 3. Status (0: OK, &lt;0: Error, &gt;0: Warning */</span></div>
<div class="line">    <a class="code" href="group__argus__log.html#gaf623b0ecc471d68c31c110c6f9abd7d2">print</a>(<span class="stringliteral">&quot;Range: %5d mm;  Amplitude: %4d LSB;  Quality: %3d;  Status: %d\n&quot;</span>,</div>
<div class="line">          res-&gt;<a class="code" href="structargus__results__t.html#aff9b50b61955470fa1d349b4fb17ff1e">Bin</a>.<a class="code" href="structargus__results__bin__t.html#a830e9e333b9fece506f2e72b92087a51">Range</a> / (<a class="code" href="group__fixedpoint.html#gae92e284f44eb56820cf5a1d330ce4c0f">Q9_22_ONE</a> / 1000),</div>
<div class="line">          res-&gt;<a class="code" href="structargus__results__t.html#aff9b50b61955470fa1d349b4fb17ff1e">Bin</a>.<a class="code" href="structargus__results__bin__t.html#a918392407fcf45cadb280ebe502d633d">Amplitude</a> / <a class="code" href="group__fixedpoint.html#gaaeaf2ed93a297c9d70f88eb356fd16e6">UQ12_4_ONE</a>,</div>
<div class="line">          res-&gt;<a class="code" href="structargus__results__t.html#aff9b50b61955470fa1d349b4fb17ff1e">Bin</a>.<a class="code" href="structargus__results__bin__t.html#a032de48d823435330e13bc0d50934227">SignalQuality</a>,</div>
<div class="line">          res-&gt;<a class="code" href="structargus__results__t.html#a94a5adbd578f9e837e084cdd79a142ca">Status</a>);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> handle_error(<a class="code" href="group__status.html#gaaabdaf7ee58ca7269bd4bf24efcde092">status_t</a> status, <span class="keywordtype">char</span> <span class="keyword">const</span> * msg)</div>
<div class="line">{</div>
<div class="line">    <span class="comment">/* Check for status &lt; 0 and print message and halt the program execution. */</span></div>
<div class="line">    <span class="keywordflow">if</span> (status &lt; <a class="code" href="group__status.html#gga67a0db04d321a74b7e7fcfd3f1a3f70ba7e4a42e3b6dd63708c64cf3db6f69566">STATUS_OK</a>)</div>
<div class="line">    {</div>
<div class="line">        <a class="code" href="group__argus__log.html#gaf623b0ecc471d68c31c110c6f9abd7d2">print</a>(<span class="stringliteral">&quot;ERROR: %s\nError Code: %d&quot;</span>, msg, status);</div>
<div class="line">        <span class="keywordflow">while</span> (1) __asm(<span class="stringliteral">&quot;nop&quot;</span>); <span class="comment">// stop!</span></div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> hardware_init(<span class="keywordtype">void</span>)</div>
<div class="line">{</div>
<div class="line">    <span class="comment">/* Initialize the board with clocks. */</span></div>
<div class="line">    BOARD_ClockInit();</div>
<div class="line"> </div>
<div class="line">    <span class="comment">/* Disable the watchdog timer. */</span></div>
<div class="line">    COP_Disable();</div>
<div class="line"> </div>
<div class="line">    <span class="comment">/* Initialize timer required by the API. */</span></div>
<div class="line">    Timer_Init();</div>
<div class="line"> </div>
<div class="line">    <span class="comment">/* Initialize UART for print functionality. */</span></div>
<div class="line">    UART_Init();</div>
<div class="line"> </div>
<div class="line">    <span class="comment">/* Initialize the S2PI hardware required by the API. */</span></div>
<div class="line">    S2PI_Init(SPI_SLAVE, SPI_BAUD_RATE);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><a class="code" href="group__status.html#gaaabdaf7ee58ca7269bd4bf24efcde092">status_t</a> measurement_ready_callback(<a class="code" href="group__status.html#gaaabdaf7ee58ca7269bd4bf24efcde092">status_t</a> status, <span class="keywordtype">void</span> * data)</div>
<div class="line">{</div>
<div class="line">    handle_error(status, <span class="stringliteral">&quot;Measurement Ready Callback received error!&quot;</span>);</div>
<div class="line"> </div>
<div class="line">    <span class="comment">/* Inform the main task about new data ready.</span></div>
<div class="line"><span class="comment">     * Note: do not call the evaluate measurement method</span></div>
<div class="line"><span class="comment">     * from within this callback since it is invoked in</span></div>
<div class="line"><span class="comment">     * a interrupt service routine and should return as</span></div>
<div class="line"><span class="comment">     * soon as possible. */</span></div>
<div class="line">    assert(myData == 0);</div>
<div class="line">    myData = data;</div>
<div class="line">    <span class="keywordflow">return</span> status;</div>
<div class="line">}</div>
<div class="ttc" id="aargus_8h_html"><div class="ttname"><a href="argus_8h.html">argus.h</a></div><div class="ttdoc">This file is part of the AFBR-S50 API.</div></div>
<div class="ttc" id="agroup__argus__log_html_gaf623b0ecc471d68c31c110c6f9abd7d2"><div class="ttname"><a href="group__argus__log.html#gaf623b0ecc471d68c31c110c6f9abd7d2">print</a></div><div class="ttdeci">status_t print(const char *fmt_s,...)</div><div class="ttdoc">A printf-like function to print formated data to an debugging interface.</div></div>
<div class="ttc" id="agroup__argusapi_html_ga0c81d41a6c8aecceca64b54c724b6a2d"><div class="ttname"><a href="group__argusapi.html#ga0c81d41a6c8aecceca64b54c724b6a2d">Argus_CreateHandle</a></div><div class="ttdeci">argus_hnd_t * Argus_CreateHandle(void)</div><div class="ttdoc">Creates a new device data handle object to store all internal states.</div></div>
<div class="ttc" id="agroup__argusapi_html_ga0ff472df08ed31ebbc16d3c6cf0c6564"><div class="ttname"><a href="group__argusapi.html#ga0ff472df08ed31ebbc16d3c6cf0c6564">argus_hnd_t</a></div><div class="ttdeci">void argus_hnd_t</div><div class="ttdef"><b>Definition:</b> argus_api.h:62</div></div>
<div class="ttc" id="agroup__argusapi_html_ga3f0b238436afb09796762fb47e9125b3"><div class="ttname"><a href="group__argusapi.html#ga3f0b238436afb09796762fb47e9125b3">Argus_GetModuleVersion</a></div><div class="ttdeci">argus_module_version_t Argus_GetModuleVersion(argus_hnd_t *hnd)</div><div class="ttdoc">Gets the version/variant of the module.</div></div>
<div class="ttc" id="agroup__argusapi_html_ga46f240b890cd62efe83bf2d095277470"><div class="ttname"><a href="group__argusapi.html#ga46f240b890cd62efe83bf2d095277470">argus_module_version_t</a></div><div class="ttdeci">argus_module_version_t</div><div class="ttdoc">The AFBR-S50 module types.</div><div class="ttdef"><b>Definition:</b> argus_def.h:85</div></div>
<div class="ttc" id="agroup__argusapi_html_ga7d724a6657138f112bff554f7db2a898"><div class="ttname"><a href="group__argusapi.html#ga7d724a6657138f112bff554f7db2a898">Argus_Init</a></div><div class="ttdeci">status_t Argus_Init(argus_hnd_t *hnd, s2pi_slave_t spi_slave)</div><div class="ttdoc">Initializes the API modules and the device with default parameters.</div></div>
<div class="ttc" id="agroup__argusapi_html_ga809f5916407f49eebf87933cfed30e2d"><div class="ttname"><a href="group__argusapi.html#ga809f5916407f49eebf87933cfed30e2d">Argus_GetChipID</a></div><div class="ttdeci">uint32_t Argus_GetChipID(argus_hnd_t *hnd)</div><div class="ttdoc">Gets the unique identification number of the chip.</div></div>
<div class="ttc" id="agroup__argusapi_html_gabec8f8d2fd8e05e1b4dc6158bffe1f23"><div class="ttname"><a href="group__argusapi.html#gabec8f8d2fd8e05e1b4dc6158bffe1f23">Argus_GetAPIVersion</a></div><div class="ttdeci">uint32_t Argus_GetAPIVersion(void)</div><div class="ttdoc">Gets the version number of the current API library.</div></div>
<div class="ttc" id="agroup__argusapi_html_gga46f240b890cd62efe83bf2d095277470a07a3ca0afd476a77d18af9cac7e8ca57"><div class="ttname"><a href="group__argusapi.html#gga46f240b890cd62efe83bf2d095277470a07a3ca0afd476a77d18af9cac7e8ca57">AFBR_S50LV85D_V1</a></div><div class="ttdeci">@ AFBR_S50LV85D_V1</div><div class="ttdef"><b>Definition:</b> argus_def.h:111</div></div>
<div class="ttc" id="agroup__argusapi_html_gga46f240b890cd62efe83bf2d095277470a2e11c996b63ce7373b0adfc0e7d2b054"><div class="ttname"><a href="group__argusapi.html#gga46f240b890cd62efe83bf2d095277470a2e11c996b63ce7373b0adfc0e7d2b054">AFBR_S50MV85G_V2</a></div><div class="ttdeci">@ AFBR_S50MV85G_V2</div><div class="ttdef"><b>Definition:</b> argus_def.h:99</div></div>
<div class="ttc" id="agroup__argusapi_html_gga46f240b890cd62efe83bf2d095277470a6623b6590854eddb5a65aad685e9800e"><div class="ttname"><a href="group__argusapi.html#gga46f240b890cd62efe83bf2d095277470a6623b6590854eddb5a65aad685e9800e">AFBR_S50MV85I_V1</a></div><div class="ttdeci">@ AFBR_S50MV85I_V1</div><div class="ttdef"><b>Definition:</b> argus_def.h:123</div></div>
<div class="ttc" id="agroup__argusapi_html_gga46f240b890cd62efe83bf2d095277470a8c26ad1349762515f29bc9a417bbadbf"><div class="ttname"><a href="group__argusapi.html#gga46f240b890cd62efe83bf2d095277470a8c26ad1349762515f29bc9a417bbadbf">AFBR_S50MV68B_V1</a></div><div class="ttdeci">@ AFBR_S50MV68B_V1</div><div class="ttdef"><b>Definition:</b> argus_def.h:117</div></div>
<div class="ttc" id="agroup__argusapi_html_gga46f240b890cd62efe83bf2d095277470aadb20086dac739d81b418ed885e13eac"><div class="ttname"><a href="group__argusapi.html#gga46f240b890cd62efe83bf2d095277470aadb20086dac739d81b418ed885e13eac">AFBR_S50MV85G_V1</a></div><div class="ttdeci">@ AFBR_S50MV85G_V1</div><div class="ttdef"><b>Definition:</b> argus_def.h:93</div></div>
<div class="ttc" id="agroup__argusapi_html_gga46f240b890cd62efe83bf2d095277470ab844937ee93fb6b8a2c8446dd89fd3d4"><div class="ttname"><a href="group__argusapi.html#gga46f240b890cd62efe83bf2d095277470ab844937ee93fb6b8a2c8446dd89fd3d4">AFBR_S50SV85K_V1</a></div><div class="ttdeci">@ AFBR_S50SV85K_V1</div><div class="ttdef"><b>Definition:</b> argus_def.h:129</div></div>
<div class="ttc" id="agroup__argusapi_html_gga46f240b890cd62efe83bf2d095277470addaaf6b9cc172c456278d5d5038070f6"><div class="ttname"><a href="group__argusapi.html#gga46f240b890cd62efe83bf2d095277470addaaf6b9cc172c456278d5d5038070f6">AFBR_S50MV85G_V3</a></div><div class="ttdeci">@ AFBR_S50MV85G_V3</div><div class="ttdef"><b>Definition:</b> argus_def.h:105</div></div>
<div class="ttc" id="agroup__arguscfg_html_gaa6d970c42ac21e56907247f58a029472"><div class="ttname"><a href="group__arguscfg.html#gaa6d970c42ac21e56907247f58a029472">Argus_SetConfigurationFrameTime</a></div><div class="ttdeci">status_t Argus_SetConfigurationFrameTime(argus_hnd_t *hnd, uint32_t value)</div><div class="ttdoc">Sets the frame time to a specified device.</div></div>
<div class="ttc" id="agroup__argusmeas_html_ga39cbc3ebea33bbc497cadd393254c239"><div class="ttname"><a href="group__argusmeas.html#ga39cbc3ebea33bbc497cadd393254c239">Argus_EvaluateData</a></div><div class="ttdeci">status_t Argus_EvaluateData(argus_hnd_t *hnd, argus_results_t *res, void *raw)</div><div class="ttdoc">Evaluate useful information from the raw measurement data.</div></div>
<div class="ttc" id="agroup__argusmeas_html_ga92c7d4e2cdfccff38bf6689935e088a5"><div class="ttname"><a href="group__argusmeas.html#ga92c7d4e2cdfccff38bf6689935e088a5">Argus_TriggerMeasurement</a></div><div class="ttdeci">status_t Argus_TriggerMeasurement(argus_hnd_t *hnd, argus_callback_t cb)</div><div class="ttdoc">Triggers a single measurement frame asynchronously.</div></div>
<div class="ttc" id="agroup__argusmeas_html_gaa80d0b10b2366f0ade05b4d7b9243497"><div class="ttname"><a href="group__argusmeas.html#gaa80d0b10b2366f0ade05b4d7b9243497">Argus_GetStatus</a></div><div class="ttdeci">status_t Argus_GetStatus(argus_hnd_t *hnd)</div><div class="ttdoc">Checks the state of the device/driver.</div></div>
<div class="ttc" id="agroup__fixedpoint_html_gaaeaf2ed93a297c9d70f88eb356fd16e6"><div class="ttname"><a href="group__fixedpoint.html#gaaeaf2ed93a297c9d70f88eb356fd16e6">UQ12_4_ONE</a></div><div class="ttdeci">#define UQ12_4_ONE</div><div class="ttdef"><b>Definition:</b> fp_def.h:230</div></div>
<div class="ttc" id="agroup__fixedpoint_html_gae92e284f44eb56820cf5a1d330ce4c0f"><div class="ttname"><a href="group__fixedpoint.html#gae92e284f44eb56820cf5a1d330ce4c0f">Q9_22_ONE</a></div><div class="ttdeci">#define Q9_22_ONE</div><div class="ttdef"><b>Definition:</b> fp_def.h:520</div></div>
<div class="ttc" id="agroup__status_html_gaaabdaf7ee58ca7269bd4bf24efcde092"><div class="ttname"><a href="group__status.html#gaaabdaf7ee58ca7269bd4bf24efcde092">status_t</a></div><div class="ttdeci">int32_t status_t</div><div class="ttdoc">Type used for all status and error return values.</div><div class="ttdef"><b>Definition:</b> argus_status.h:63</div></div>
<div class="ttc" id="agroup__status_html_gga67a0db04d321a74b7e7fcfd3f1a3f70ba27b7b4ca606d6208a2ada6df1af6ab88"><div class="ttname"><a href="group__status.html#gga67a0db04d321a74b7e7fcfd3f1a3f70ba27b7b4ca606d6208a2ada6df1af6ab88">STATUS_BUSY</a></div><div class="ttdeci">@ STATUS_BUSY</div><div class="ttdef"><b>Definition:</b> argus_status.h:82</div></div>
<div class="ttc" id="agroup__status_html_gga67a0db04d321a74b7e7fcfd3f1a3f70ba3ec68d249b5ffaa0da7e0a1170f592a2"><div class="ttname"><a href="group__status.html#gga67a0db04d321a74b7e7fcfd3f1a3f70ba3ec68d249b5ffaa0da7e0a1170f592a2">STATUS_ARGUS_POWERLIMIT</a></div><div class="ttdeci">@ STATUS_ARGUS_POWERLIMIT</div><div class="ttdef"><b>Definition:</b> argus_status.h:160</div></div>
<div class="ttc" id="agroup__status_html_gga67a0db04d321a74b7e7fcfd3f1a3f70ba7e4a42e3b6dd63708c64cf3db6f69566"><div class="ttname"><a href="group__status.html#gga67a0db04d321a74b7e7fcfd3f1a3f70ba7e4a42e3b6dd63708c64cf3db6f69566">STATUS_OK</a></div><div class="ttdeci">@ STATUS_OK</div><div class="ttdef"><b>Definition:</b> argus_status.h:73</div></div>
<div class="ttc" id="agroup__status_html_gga67a0db04d321a74b7e7fcfd3f1a3f70ba841c3e4e3ac94c0005f107140e184276"><div class="ttname"><a href="group__status.html#gga67a0db04d321a74b7e7fcfd3f1a3f70ba841c3e4e3ac94c0005f107140e184276">ERROR_FAIL</a></div><div class="ttdeci">@ ERROR_FAIL</div><div class="ttdef"><b>Definition:</b> argus_status.h:88</div></div>
<div class="ttc" id="astructargus__results__bin__t_html_a032de48d823435330e13bc0d50934227"><div class="ttname"><a href="structargus__results__bin__t.html#a032de48d823435330e13bc0d50934227">argus_results_bin_t::SignalQuality</a></div><div class="ttdeci">uint8_t SignalQuality</div><div class="ttdef"><b>Definition:</b> argus_res.h:82</div></div>
<div class="ttc" id="astructargus__results__bin__t_html_a830e9e333b9fece506f2e72b92087a51"><div class="ttname"><a href="structargus__results__bin__t.html#a830e9e333b9fece506f2e72b92087a51">argus_results_bin_t::Range</a></div><div class="ttdeci">q9_22_t Range</div><div class="ttdef"><b>Definition:</b> argus_res.h:71</div></div>
<div class="ttc" id="astructargus__results__bin__t_html_a918392407fcf45cadb280ebe502d633d"><div class="ttname"><a href="structargus__results__bin__t.html#a918392407fcf45cadb280ebe502d633d">argus_results_bin_t::Amplitude</a></div><div class="ttdeci">uq12_4_t Amplitude</div><div class="ttdef"><b>Definition:</b> argus_res.h:76</div></div>
<div class="ttc" id="astructargus__results__t_html"><div class="ttname"><a href="structargus__results__t.html">argus_results_t</a></div><div class="ttdoc">The measurement results data structure.</div><div class="ttdef"><b>Definition:</b> argus_res.h:160</div></div>
<div class="ttc" id="astructargus__results__t_html_a94a5adbd578f9e837e084cdd79a142ca"><div class="ttname"><a href="structargus__results__t.html#a94a5adbd578f9e837e084cdd79a142ca">argus_results_t::Status</a></div><div class="ttdeci">status_t Status</div><div class="ttdef"><b>Definition:</b> argus_res.h:165</div></div>
<div class="ttc" id="astructargus__results__t_html_aff9b50b61955470fa1d349b4fb17ff1e"><div class="ttname"><a href="structargus__results__t.html#aff9b50b61955470fa1d349b4fb17ff1e">argus_results_t::Bin</a></div><div class="ttdeci">argus_results_bin_t Bin</div><div class="ttdef"><b>Definition:</b> argus_res.h:216</div></div>
</div><!-- fragment --><h1><a class="anchor" id="gs_adv_example"></a>
Advanced Example</h1>
<p>Here is an example of how to use the API with the autonomous measurement triggering. The 1D range value of the obtained measurement data is streamed via an UART connection. Open a terminal (e.g. <a href="https://www.compuphase.com/software_termite.htm">Termite</a>) and open a UART connection using 115200 bps, 8N1, no handshake connection. Range values will start to occur on the terminal as soon as the program starts its execution.</p>
<p>Please find the example files in "[INSTALL_DIR]\Device\Examples\" (default is "C:\Program Files (x86)\Broadcom\AFBR-S50 SDK\Device\Examples\").</p>
<div class="fragment"><div class="line"><span class="comment">/*************************************************************************/</span></div>
<div class="line"><span class="comment">/*******************************************************************************</span></div>
<div class="line"><span class="comment"> * Include Files</span></div>
<div class="line"><span class="comment"> ******************************************************************************/</span></div>
<div class="line"><span class="preprocessor">#include &quot;<a class="code" href="argus_8h.html">argus.h</a>&quot;</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &quot;board/clock_config.h&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;driver/cop.h&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;driver/s2pi.h&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;driver/uart.h&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;driver/timer.h&quot;</span></div>
<div class="line"><span class="preprocessor">#if defined(CPU_MKL46Z256VLL4) || defined(CPU_MKL17Z256VFM4)</span></div>
<div class="line"><span class="preprocessor">#elif defined(STM32F401xE)</span></div>
<div class="line"><span class="preprocessor">#include &quot;main.h&quot;</span></div>
<div class="line"><span class="preprocessor">#else</span></div>
<div class="line"><span class="preprocessor">#error No target specified!</span></div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="comment">/*******************************************************************************</span></div>
<div class="line"><span class="comment"> * Defines</span></div>
<div class="line"><span class="comment"> ******************************************************************************/</span></div>
<div class="line"><span class="preprocessor">#define SPI_SLAVE 1</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#define SPI_BAUD_RATE 6000000</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">/*******************************************************************************</span></div>
<div class="line"><span class="comment"> * Variables</span></div>
<div class="line"><span class="comment"> ******************************************************************************/</span></div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keyword">volatile</span> <span class="keywordtype">void</span> * myData = 0;</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="comment">/*******************************************************************************</span></div>
<div class="line"><span class="comment"> * Prototypes</span></div>
<div class="line"><span class="comment"> ******************************************************************************/</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">/*!***************************************************************************</span></div>
<div class="line"><span class="comment"> * @brief   printf-like function to send print messages via UART.</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> * @details Defined in &quot;driver/uart.c&quot; source file.</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> *          Open an UART connection with 115200 bps, 8N1, no handshake to</span></div>
<div class="line"><span class="comment"> *          receive the data on a computer.</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> * @param   fmt_s The usual printf parameters.</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> * @return  Returns the \link #status_t status\endlink (#STATUS_OK on success).</span></div>
<div class="line"><span class="comment"> *****************************************************************************/</span></div>
<div class="line"><span class="keyword">extern</span> <a class="code" href="group__status.html#gaaabdaf7ee58ca7269bd4bf24efcde092">status_t</a> <a class="code" href="group__argus__log.html#gaf623b0ecc471d68c31c110c6f9abd7d2">print</a>(<span class="keyword">const</span> <span class="keywordtype">char</span>  *fmt_s, ...);</div>
<div class="line"> </div>
<div class="line"><span class="comment">/*!***************************************************************************</span></div>
<div class="line"><span class="comment"> * @brief   Prints measurement results via UART.</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> * @details Prints some measurement data via UART in the following format:</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> *          Range: 123456 mm;  Amplitude: 1234 LSB  Status: 0</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> * @param   res A pointer to the latest measurement results structure.</span></div>
<div class="line"><span class="comment"> *****************************************************************************/</span></div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> print_results(<a class="code" href="structargus__results__t.html">argus_results_t</a> <span class="keyword">const</span> * res);</div>
<div class="line"> </div>
<div class="line"><span class="comment">/*!***************************************************************************</span></div>
<div class="line"><span class="comment"> * @brief   Initialization routine for board hardware and peripherals.</span></div>
<div class="line"><span class="comment"> *****************************************************************************/</span></div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> hardware_init(<span class="keywordtype">void</span>);</div>
<div class="line"> </div>
<div class="line"><span class="comment">/*!***************************************************************************</span></div>
<div class="line"><span class="comment"> * @brief   Measurement data ready callback function.</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> * @param   status The measurement/device status from the last measurement cycle.</span></div>
<div class="line"><span class="comment"> * @param   data A pointer to the raw measurement data results that need to be</span></div>
<div class="line"><span class="comment"> *               passed to the #Argus_EvaluateData function.</span></div>
<div class="line"><span class="comment"> * @return  Returns the \link #status_t status\endlink (#STATUS_OK on success).</span></div>
<div class="line"><span class="comment"> *****************************************************************************/</span></div>
<div class="line"><a class="code" href="group__status.html#gaaabdaf7ee58ca7269bd4bf24efcde092">status_t</a> measurement_ready_callback(<a class="code" href="group__status.html#gaaabdaf7ee58ca7269bd4bf24efcde092">status_t</a> status, <span class="keywordtype">void</span> * data);</div>
<div class="line"> </div>
<div class="line"><span class="comment">/*!***************************************************************************</span></div>
<div class="line"><span class="comment"> * @brief   A very brief example for error handling.</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> * @details Checks the specified status for errors (i.e. negative values) and</span></div>
<div class="line"><span class="comment"> *          prints a specified error message if any. An endless loop is entered</span></div>
<div class="line"><span class="comment"> *          to halt program execution.</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> * @param   status The specified status to be checked for errors.</span></div>
<div class="line"><span class="comment"> * @param   msg The associated error message to be printed in case of errors.</span></div>
<div class="line"><span class="comment"> *****************************************************************************/</span></div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> handle_error(<a class="code" href="group__status.html#gaaabdaf7ee58ca7269bd4bf24efcde092">status_t</a> status, <span class="keywordtype">char</span> <span class="keyword">const</span> * msg);</div>
<div class="line"> </div>
<div class="line"><span class="comment">/*******************************************************************************</span></div>
<div class="line"><span class="comment"> * Code</span></div>
<div class="line"><span class="comment"> ******************************************************************************/</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">/*!***************************************************************************</span></div>
<div class="line"><span class="comment"> * @brief   Application entry point.</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> * @details The main function of the program, called after startup code</span></div>
<div class="line"><span class="comment"> *          This function should never be exited.</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> * @return  Never returns anything...</span></div>
<div class="line"><span class="comment"> *****************************************************************************/</span></div>
<div class="line"><span class="keywordtype">int</span> main(<span class="keywordtype">void</span>)</div>
<div class="line">{</div>
<div class="line">    <a class="code" href="group__status.html#gaaabdaf7ee58ca7269bd4bf24efcde092">status_t</a> status = <a class="code" href="group__status.html#gga67a0db04d321a74b7e7fcfd3f1a3f70ba7e4a42e3b6dd63708c64cf3db6f69566">STATUS_OK</a>;</div>
<div class="line"> </div>
<div class="line">    <span class="comment">/* Initialize the platform hardware including the required peripherals</span></div>
<div class="line"><span class="comment">     * for the API. */</span></div>
<div class="line">    hardware_init();</div>
<div class="line"> </div>
<div class="line">    <span class="comment">/* The API module handle that contains all data definitions that is</span></div>
<div class="line"><span class="comment">     * required within the API module for the corresponding hardware device.</span></div>
<div class="line"><span class="comment">     * Every call to an API function requires the passing of a pointer to this</span></div>
<div class="line"><span class="comment">     * data structure. */</span></div>
<div class="line">    <a class="code" href="group__argusapi.html#ga0ff472df08ed31ebbc16d3c6cf0c6564">argus_hnd_t</a> * hnd = <a class="code" href="group__argusapi.html#ga0c81d41a6c8aecceca64b54c724b6a2d">Argus_CreateHandle</a>();</div>
<div class="line">    handle_error(hnd ? <a class="code" href="group__status.html#gga67a0db04d321a74b7e7fcfd3f1a3f70ba7e4a42e3b6dd63708c64cf3db6f69566">STATUS_OK</a> : <a class="code" href="group__status.html#gga67a0db04d321a74b7e7fcfd3f1a3f70ba841c3e4e3ac94c0005f107140e184276">ERROR_FAIL</a>, <span class="stringliteral">&quot;Argus_CreateHandle failed!&quot;</span>);</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">    <span class="comment">/* Initialize the API with default values.</span></div>
<div class="line"><span class="comment">     * This implicitly calls the initialization functions</span></div>
<div class="line"><span class="comment">     * of the underlying API modules.</span></div>
<div class="line"><span class="comment">     *</span></div>
<div class="line"><span class="comment">     * The second parameter is stored and passed to all function calls</span></div>
<div class="line"><span class="comment">     * to the S2PI module. This piece of information can be utilized in</span></div>
<div class="line"><span class="comment">     * order to determine the addressed SPI slave and enabled the usage</span></div>
<div class="line"><span class="comment">     * of multiple devices on a single SPI peripheral. */</span></div>
<div class="line">    status = <a class="code" href="group__argusapi.html#ga7d724a6657138f112bff554f7db2a898">Argus_Init</a>(hnd, SPI_SLAVE);</div>
<div class="line">    handle_error(status, <span class="stringliteral">&quot;Argus_Init failed!&quot;</span>);</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">    <span class="comment">/* Print some information about current API and connected device. */</span></div>
<div class="line">    uint32_t value = <a class="code" href="group__argusapi.html#gabec8f8d2fd8e05e1b4dc6158bffe1f23">Argus_GetAPIVersion</a>();</div>
<div class="line">    uint8_t a = (value &gt;&gt; 24) &amp; 0xFFU;</div>
<div class="line">    uint8_t b = (value &gt;&gt; 16) &amp; 0xFFU;</div>
<div class="line">    uint8_t c = value &amp; 0xFFFFU;</div>
<div class="line">    uint32_t <span class="keywordtype">id</span> = <a class="code" href="group__argusapi.html#ga809f5916407f49eebf87933cfed30e2d">Argus_GetChipID</a>(hnd);</div>
<div class="line">    <a class="code" href="group__argusapi.html#ga46f240b890cd62efe83bf2d095277470">argus_module_version_t</a> mv = <a class="code" href="group__argusapi.html#ga3f0b238436afb09796762fb47e9125b3">Argus_GetModuleVersion</a>(hnd);</div>
<div class="line">    <a class="code" href="group__argus__log.html#gaf623b0ecc471d68c31c110c6f9abd7d2">print</a>(<span class="stringliteral">&quot;\n##### AFBR-S50 API - Advanced Example ############\n&quot;</span></div>
<div class="line">          <span class="stringliteral">&quot;  API Version: v%d.%d.%d\n&quot;</span></div>
<div class="line">          <span class="stringliteral">&quot;  Chip ID:     %d\n&quot;</span></div>
<div class="line">          <span class="stringliteral">&quot;  Module:      %s\n&quot;</span></div>
<div class="line">          <span class="stringliteral">&quot;##################################################\n&quot;</span>,</div>
<div class="line">          a, b, c, <span class="keywordtype">id</span>,</div>
<div class="line">          mv == <a class="code" href="group__argusapi.html#gga46f240b890cd62efe83bf2d095277470aadb20086dac739d81b418ed885e13eac">AFBR_S50MV85G_V1</a> ? <span class="stringliteral">&quot;AFBR-S50MV85G (v1)&quot;</span> :</div>
<div class="line">          mv == <a class="code" href="group__argusapi.html#gga46f240b890cd62efe83bf2d095277470a2e11c996b63ce7373b0adfc0e7d2b054">AFBR_S50MV85G_V2</a> ? <span class="stringliteral">&quot;AFBR-S50MV85G (v2)&quot;</span> :</div>
<div class="line">          mv == <a class="code" href="group__argusapi.html#gga46f240b890cd62efe83bf2d095277470addaaf6b9cc172c456278d5d5038070f6">AFBR_S50MV85G_V3</a> ? <span class="stringliteral">&quot;AFBR-S50MV85G (v3)&quot;</span> :</div>
<div class="line">          mv == <a class="code" href="group__argusapi.html#gga46f240b890cd62efe83bf2d095277470a07a3ca0afd476a77d18af9cac7e8ca57">AFBR_S50LV85D_V1</a> ? <span class="stringliteral">&quot;AFBR-S50LV85D (v1)&quot;</span> :</div>
<div class="line">          mv == <a class="code" href="group__argusapi.html#gga46f240b890cd62efe83bf2d095277470a8c26ad1349762515f29bc9a417bbadbf">AFBR_S50MV68B_V1</a> ? <span class="stringliteral">&quot;AFBR-S50MV68B (v1)&quot;</span> :</div>
<div class="line">          mv == <a class="code" href="group__argusapi.html#gga46f240b890cd62efe83bf2d095277470a6623b6590854eddb5a65aad685e9800e">AFBR_S50MV85I_V1</a> ? <span class="stringliteral">&quot;AFBR-S50MV85I (v1)&quot;</span> :</div>
<div class="line">          mv == <a class="code" href="group__argusapi.html#gga46f240b890cd62efe83bf2d095277470ab844937ee93fb6b8a2c8446dd89fd3d4">AFBR_S50SV85K_V1</a> ? <span class="stringliteral">&quot;AFBR-S50SV85K (v1)&quot;</span> :</div>
<div class="line">          <span class="stringliteral">&quot;unknown&quot;</span>);</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">    <span class="comment">/* Adjust some configuration parameters by invoking the dedicated API methods. */</span></div>
<div class="line">    status = <a class="code" href="group__arguscfg.html#gaa6d970c42ac21e56907247f58a029472">Argus_SetConfigurationFrameTime</a>( hnd, 100000 ); <span class="comment">// 0.1 second = 10 Hz</span></div>
<div class="line">    handle_error(status, <span class="stringliteral">&quot;Argus_SetConfigurationFrameTime failed!&quot;</span>);</div>
<div class="line"> </div>
<div class="line">    <span class="comment">/* Start the measurement timers within the API module.</span></div>
<div class="line"><span class="comment">     * The callback is invoked every time a measurement has been finished.</span></div>
<div class="line"><span class="comment">     * The callback is used to schedule the data evaluation routine to the</span></div>
<div class="line"><span class="comment">     * main thread by the user.</span></div>
<div class="line"><span class="comment">     * Note that the timer based measurement is not implemented for multiple</span></div>
<div class="line"><span class="comment">     * instance yet! */</span></div>
<div class="line">    status = <a class="code" href="group__argusmeas.html#gae1682b01c1ed1b837fd7d763d81e857c">Argus_StartMeasurementTimer</a>(hnd, measurement_ready_callback);</div>
<div class="line">    handle_error(status, <span class="stringliteral">&quot;Argus_StartMeasurementTimer failed!&quot;</span>);</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">    <span class="comment">/* The program loop ... */</span></div>
<div class="line">    <span class="keywordflow">for</span>(;;)</div>
<div class="line">    {</div>
<div class="line">        <span class="comment">/* Check if new measurement data is ready. */</span></div>
<div class="line">        <span class="keywordflow">if</span> (myData != 0)</div>
<div class="line">        {</div>
<div class="line">            <span class="comment">/* Release for next measurement data. */</span></div>
<div class="line">            <span class="keywordtype">void</span> * data = (<span class="keywordtype">void</span> *) myData;</div>
<div class="line">            myData = 0;</div>
<div class="line"> </div>
<div class="line">            <span class="comment">/* The measurement data structure. */</span></div>
<div class="line">            <a class="code" href="structargus__results__t.html">argus_results_t</a> res;</div>
<div class="line"> </div>
<div class="line">            <span class="comment">/* Evaluate the raw measurement results. */</span></div>
<div class="line">            status = <a class="code" href="group__argusmeas.html#ga39cbc3ebea33bbc497cadd393254c239">Argus_EvaluateData</a>(hnd, &amp;res, data);</div>
<div class="line">            handle_error(status, <span class="stringliteral">&quot;Argus_EvaluateData failed!&quot;</span>);</div>
<div class="line"> </div>
<div class="line">            <span class="comment">/* Use the obtain results, e.g. print via UART. */</span></div>
<div class="line">            print_results(&amp;res);</div>
<div class="line">        }</div>
<div class="line">        <span class="keywordflow">else</span></div>
<div class="line">        {</div>
<div class="line">            <span class="comment">/* User code here... */</span></div>
<div class="line">            __asm(<span class="stringliteral">&quot;nop&quot;</span>);</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> print_results(<a class="code" href="structargus__results__t.html">argus_results_t</a> <span class="keyword">const</span> * res)</div>
<div class="line">{</div>
<div class="line">    <span class="comment">/* Print the recent measurement results:</span></div>
<div class="line"><span class="comment">     * 1. Range in mm (converting the Q9.22 value to mm)</span></div>
<div class="line"><span class="comment">     * 2. Amplitude in LSB (converting the UQ12.4 value to LSB)</span></div>
<div class="line"><span class="comment">     * 3. Status (0: OK, &lt;0: Error, &gt;0: Warning */</span></div>
<div class="line">    <a class="code" href="group__argus__log.html#gaf623b0ecc471d68c31c110c6f9abd7d2">print</a>(<span class="stringliteral">&quot;Range: %5d mm;  Amplitude: %4d LSB;  Quality: %3d;  Status: %d\n&quot;</span>,</div>
<div class="line">          res-&gt;<a class="code" href="structargus__results__t.html#aff9b50b61955470fa1d349b4fb17ff1e">Bin</a>.<a class="code" href="structargus__results__bin__t.html#a830e9e333b9fece506f2e72b92087a51">Range</a> / (<a class="code" href="group__fixedpoint.html#gae92e284f44eb56820cf5a1d330ce4c0f">Q9_22_ONE</a> / 1000),</div>
<div class="line">          res-&gt;<a class="code" href="structargus__results__t.html#aff9b50b61955470fa1d349b4fb17ff1e">Bin</a>.<a class="code" href="structargus__results__bin__t.html#a918392407fcf45cadb280ebe502d633d">Amplitude</a> / <a class="code" href="group__fixedpoint.html#gaaeaf2ed93a297c9d70f88eb356fd16e6">UQ12_4_ONE</a>,</div>
<div class="line">          res-&gt;<a class="code" href="structargus__results__t.html#aff9b50b61955470fa1d349b4fb17ff1e">Bin</a>.<a class="code" href="structargus__results__bin__t.html#a032de48d823435330e13bc0d50934227">SignalQuality</a>,</div>
<div class="line">          res-&gt;<a class="code" href="structargus__results__t.html#a94a5adbd578f9e837e084cdd79a142ca">Status</a>);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> handle_error(<a class="code" href="group__status.html#gaaabdaf7ee58ca7269bd4bf24efcde092">status_t</a> status, <span class="keywordtype">char</span> <span class="keyword">const</span> * msg)</div>
<div class="line">{</div>
<div class="line">    <span class="comment">/* Check for status &lt; 0 and print message and halt the program execution. */</span></div>
<div class="line">    <span class="keywordflow">if</span> (status &lt; <a class="code" href="group__status.html#gga67a0db04d321a74b7e7fcfd3f1a3f70ba7e4a42e3b6dd63708c64cf3db6f69566">STATUS_OK</a>)</div>
<div class="line">    {</div>
<div class="line">        <a class="code" href="group__argus__log.html#gaf623b0ecc471d68c31c110c6f9abd7d2">print</a>(<span class="stringliteral">&quot;ERROR: %s\nError Code: %d&quot;</span>, msg, status);</div>
<div class="line">        <span class="keywordflow">while</span> (1) __asm(<span class="stringliteral">&quot;nop&quot;</span>); <span class="comment">// stop!</span></div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> hardware_init(<span class="keywordtype">void</span>)</div>
<div class="line">{</div>
<div class="line">    <span class="comment">/* Initialize the board with clocks. */</span></div>
<div class="line">    BOARD_ClockInit();</div>
<div class="line"> </div>
<div class="line">    <span class="comment">/* Disable the watchdog timer. */</span></div>
<div class="line">    COP_Disable();</div>
<div class="line"> </div>
<div class="line">    <span class="comment">/* Initialize timer required by the API. */</span></div>
<div class="line">    Timer_Init();</div>
<div class="line"> </div>
<div class="line">    <span class="comment">/* Initialize UART for print functionality. */</span></div>
<div class="line">    UART_Init();</div>
<div class="line"> </div>
<div class="line">    <span class="comment">/* Initialize the S2PI hardware required by the API. */</span></div>
<div class="line">    S2PI_Init(SPI_SLAVE, SPI_BAUD_RATE);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><a class="code" href="group__status.html#gaaabdaf7ee58ca7269bd4bf24efcde092">status_t</a> measurement_ready_callback(<a class="code" href="group__status.html#gaaabdaf7ee58ca7269bd4bf24efcde092">status_t</a> status, <span class="keywordtype">void</span> * data)</div>
<div class="line">{</div>
<div class="line">    handle_error(status, <span class="stringliteral">&quot;Measurement Ready Callback received error!&quot;</span>);</div>
<div class="line"> </div>
<div class="line">    <span class="comment">/* Inform the main task about new data ready.</span></div>
<div class="line"><span class="comment">     * Note: do not call the evaluate measurement method</span></div>
<div class="line"><span class="comment">     * from within this callback since it is invoked in</span></div>
<div class="line"><span class="comment">     * a interrupt service routine and should return as</span></div>
<div class="line"><span class="comment">     * soon as possible. */</span></div>
<div class="line">    assert(myData == 0);</div>
<div class="line">    myData = data;</div>
<div class="line">    <span class="keywordflow">return</span> status;</div>
<div class="line">}</div>
<div class="ttc" id="agroup__argusmeas_html_gae1682b01c1ed1b837fd7d763d81e857c"><div class="ttname"><a href="group__argusmeas.html#gae1682b01c1ed1b837fd7d763d81e857c">Argus_StartMeasurementTimer</a></div><div class="ttdeci">status_t Argus_StartMeasurementTimer(argus_hnd_t *hnd, argus_callback_t cb)</div><div class="ttdoc">Starts the timer based measurement cycle asynchronously.</div></div>
</div><!-- fragment --> </div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- HTML footer for doxygen 1.8.13-->
<!-- start footer part -->
<div id="nav-path" class="navpath">
	<!-- id is needed for treeview function! -->
	<ul>
		<li class="footer"> 
			<a href="https://www.broadcom.com/">Broadcom Inc.</a>
		</li>
	</ul>
</div>
</body>
</html>