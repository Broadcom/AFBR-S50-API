<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.12.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>AFBR-S50 API Reference Manual: Getting Started</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  extensions: ["tex2jax.js"],
  jax: ["input/TeX","output/HTML-CSS"],
});
</script>
<script type="text/javascript" async="async" src="https://cdn.jsdelivr.net/npm/mathjax@2/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="style.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectlogo"><img alt="Logo" src="AFBR-S50.ico"/></td>
  <td id="projectalign">
   <div id="projectname">AFBR-S50 API Reference Manual<span id="projectnumber">&#160;v1.6.5</span>
   </div>
   <div id="projectbrief">AFBR-S50 Time-of-Flight Sensor SDK for Embedded Software</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.12.0 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() { codefold.init(0); });
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search',true);
  $(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function(){initNavTree('getting_started.html',''); initResizable(true); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Getting Started</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="md__doxygen_203__0__getting__started"></a></p>
<p>The following section gives an brief overview on of the <b>AFBR-S50 Core Library and API</b> and shows how to get started using the evaluation or reference platforms and example applications.</p>
<p>In order to get more information about the featured applications, refer to the <a class="el" href="apps.html">Demo Applications</a> section.</p>
<p>If a port to another microcontroller platform is required, refer to the <a class="el" href="porting_guide.html">MCU Porting Guide</a> section.</p>
<h1><a class="anchor" id="gs_build"></a>
Build And Run Projects</h1>
<p>To directly dive into building and debugging the featured projects, go to the corresponding IDE getting started section:</p>
<ul>
<li><a class="el" href="mcuxpresso.html">MCUXpresso IDE</a></li>
<li><a class="el" href="e2studio.html">e² Studio IDE</a></li>
<li><a class="el" href="stm32cubeide.html">STM32CubeIDE</a></li>
</ul>
<p>Here is an overview of the featured targets and the required IDEs:</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Board   </th><th class="markdownTableHeadNone">MCU   </th><th class="markdownTableHeadNone">IDE   </th><th class="markdownTableHeadNone">Comment    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">AFBR-S50 Evaluation Kit   </td><td class="markdownTableBodyNone"><a href="https://www.nxp.com/products/processors-and-microcontrollers/arm-microcontrollers/general-purpose-mcus/kl-series-cortex-m0-plus/kinetis-kl4x-48-mhz-usb-segment-lcd-ultra-low-power-microcontrollers-mcus-based-on-arm-cortex-m0-plus-core:KL4x">NXP Kinetis MKL46z</a>   </td><td class="markdownTableBodyNone"><a class="el" href="mcuxpresso.html">MCUXpresso IDE</a>   </td><td class="markdownTableBodyNone">Based on the <a href="https://www.nxp.com/design/development-boards/freedom-development-boards/mcu-boards/freedom-development-platform-for-kinetis-kl3x-and-kl4x-mcus:FRDM-KL46Z">NXP FRDM-KL46z</a> Evaluation Board    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">AFBR-S50 Reference Design   </td><td class="markdownTableBodyNone"><a href="https://www.nxp.com/products/processors-and-microcontrollers/arm-microcontrollers/general-purpose-mcus/kl-series-cortex-m0-plus/kinetis-kl1x-48-mhz-mainstream-small-ultra-low-power-microcontrollers-mcus-based-on-arm-cortex-m0-plus-core:KL1x">NXP Kinetis MKL17z</a>   </td><td class="markdownTableBodyNone"><a class="el" href="mcuxpresso.html">MCUXpresso IDE</a>   </td><td class="markdownTableBodyNone"></td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">AFBR-S50 Evaluation Kit   </td><td class="markdownTableBodyNone"><a href="https://www.st.com/en/microcontrollers-microprocessors/stm32f401re.html">STM32F401RE</a>   </td><td class="markdownTableBodyNone"><a class="el" href="stm32cubeide.html">STM32CubeIDE</a>   </td><td class="markdownTableBodyNone">Based on the <a href="https://www.st.com/en/evaluation-tools/nucleo-f401re.html">STM32 NUCLEO-F401RE</a> Evaluation Board    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><a class="el" href="reference_board.html">AFBR-S50 Reference Board</a>   </td><td class="markdownTableBodyNone"><a href="https://www.renesas.com/us/en/products/microcontrollers-microprocessors/ra-cortex-m-mcus/ra4m2-100mhz-arm-cortex-m33-trustzone-high-integration-lowest-active-power-consumption">Renesas RA4M2</a>   </td><td class="markdownTableBodyNone"><a class="el" href="e2studio.html">e² Studio IDE</a>   </td><td class="markdownTableBodyNone">Provided by <b>MikroElektronika</b>   </td></tr>
</table>
<h1><a class="anchor" id="gs_api"></a>
Using the AFBR-S50 API</h1>
<dl class="section note"><dt>Note</dt><dd>All <b>AFBR-S50 API</b> related functions, definitions and constants have a prefix <code>Argus_</code> which is essentially an alias or working title for the <b>AFBR-S50 Time-of-Flight Sensor</b> device.</dd></dl>
<p>The <b>AFBR-S50 Core Library</b> is provided as a static ANSI-C library file (<code>lib*.a</code>) and the corresponding API is provided as ANSI-C header files (<code>*.h</code>). After setting up the linker to link the library, it is sufficient to include the main header in the <code>AFBR-S50/Include</code> folder, <code><a class="el" href="argus_8h.html" title="This file is part of the AFBR-S50 API.">argus.h</a></code>:</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &quot;<a class="code" href="argus_8h.html">argus.h</a>&quot;</span></div>
<div class="ttc" id="aargus_8h_html"><div class="ttname"><a href="argus_8h.html">argus.h</a></div><div class="ttdoc">This file is part of the AFBR-S50 API.</div></div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md3"></a>
Initialization</h2>
<p>The API utilizes an abstract handler object that contains all internal states for a single time-of-flight sensor device. In this way, it is possible to use the same API with more than a single device. After including the header file, the handler object must be created by calling the <a class="el" href="group__argus__api.html#ga9659d7e8259b5471873d04ef1e74b568" title="Creates a new device data handle object to store all internal states.">Argus_CreateHandle</a> function to obtain a pointer to the newly allocated object. This is done via the standard library function:</p>
<div class="fragment"><div class="line"><span class="keywordtype">void</span> * malloc(<span class="keywordtype">size_t</span> size)</div>
</div><!-- fragment --><p>If it is required to use a different function, create and overwrite the weakly linked method and implement your own memory allocation algorithm:</p>
<div class="fragment"><div class="line"><span class="keywordtype">void</span> * Argus_Malloc(<span class="keywordtype">size_t</span> size) { <span class="comment">/* ... */</span> }</div>
</div><!-- fragment --><p>After creation of the handler object, the <b>AFBR-S50</b> module must be initialized with the corresponding handler object:</p>
<div class="fragment"><div class="line"><a class="code hl_typedef" href="group__argus__status.html#gaaabdaf7ee58ca7269bd4bf24efcde092">status_t</a> <a class="code hl_variable" href="group__argus__xtk__cli.html#gaea26d52d2e16010e3e3e3ce0e8a1a0ce">status</a> = <a class="code hl_function" href="group__argus__api.html#ga7d724a6657138f112bff554f7db2a898">Argus_Init</a>(<a class="code hl_variable" href="group__can__app.html#ga2d27bf0fb9aa6adc91a167402541c03b">hnd</a>, <a class="code hl_define" href="group__example__apps.html#ga943af7f8a98cf5a3f2107ed593215a4b">SPI_SLAVE</a>);</div>
<div class="ttc" id="agroup__argus__api_html_ga7d724a6657138f112bff554f7db2a898"><div class="ttname"><a href="group__argus__api.html#ga7d724a6657138f112bff554f7db2a898">Argus_Init</a></div><div class="ttdeci">status_t Argus_Init(argus_hnd_t *hnd, s2pi_slave_t spi_slave)</div><div class="ttdoc">Initializes the device with default measurement mode.</div></div>
<div class="ttc" id="agroup__argus__status_html_gaaabdaf7ee58ca7269bd4bf24efcde092"><div class="ttname"><a href="group__argus__status.html#gaaabdaf7ee58ca7269bd4bf24efcde092">status_t</a></div><div class="ttdeci">int32_t status_t</div><div class="ttdoc">Type used for all status and error return values.</div><div class="ttdef"><b>Definition</b> argus_status.h:70</div></div>
<div class="ttc" id="agroup__argus__xtk__cli_html_gaea26d52d2e16010e3e3e3ce0e8a1a0ce"><div class="ttname"><a href="group__argus__xtk__cli.html#gaea26d52d2e16010e3e3e3ce0e8a1a0ce">status</a></div><div class="ttdeci">static status_t status</div><div class="ttdef"><b>Definition</b> argus_xtalk_cal_cli.c:140</div></div>
<div class="ttc" id="agroup__can__app_html_ga2d27bf0fb9aa6adc91a167402541c03b"><div class="ttname"><a href="group__can__app.html#ga2d27bf0fb9aa6adc91a167402541c03b">hnd</a></div><div class="ttdeci">argus_hnd_t * hnd</div><div class="ttdef"><b>Definition</b> main.c:100</div></div>
<div class="ttc" id="agroup__example__apps_html_ga943af7f8a98cf5a3f2107ed593215a4b"><div class="ttname"><a href="group__example__apps.html#ga943af7f8a98cf5a3f2107ed593215a4b">SPI_SLAVE</a></div><div class="ttdeci">#define SPI_SLAVE</div><div class="ttdef"><b>Definition</b> examples.h:103</div></div>
</div><!-- fragment --><p>Note that all peripheral modules must be ready to be used before executing any API function. So make sure to initialize the board and its peripherals before initializing the API via <a class="el" href="group__argus__api.html#ga7d724a6657138f112bff554f7db2a898" title="Initializes the device with default measurement mode.">Argus_Init</a>.</p>
<p>After calling <a class="el" href="group__argus__api.html#ga7d724a6657138f112bff554f7db2a898" title="Initializes the device with default measurement mode.">Argus_Init</a>, the device is ready to run and has been setup with default configuration and calibration data. Use the provided API functions to customize the given default configuration to the needs and requirements of the application.</p>
<p>Note that <a class="el" href="group__argus__api.html#ga7d724a6657138f112bff554f7db2a898" title="Initializes the device with default measurement mode.">Argus_Init</a> returns <a class="el" href="group__argus__status.html#gga67a0db04d321a74b7e7fcfd3f1a3f70ba7e4a42e3b6dd63708c64cf3db6f69566">STATUS_OK</a> on successful initialization. In case of any non-zero return value, refer to the <a class="el" href="faq.html">Troubleshooting</a> section</p>
<h2><a class="anchor" id="autotoc_md4"></a>
Running Measurements</h2>
<p>There are two possibilities to operate the device:</p>
<ul>
<li>Trigger single measurements and poll the device status.</li>
<li>Utilize a periodic interrupt timer to periodically start measurements autonomously.</li>
</ul>
<h3><a class="anchor" id="autotoc_md5"></a>
Single Measurements</h3>
<p>Using the simple polling method, the measurements are triggered by the main thread by calling the <a class="el" href="group__argus__meas.html#ga4c115715544c1f66cf39f1a1f649f093" title="Triggers a single measurement frame asynchronously.">Argus_TriggerMeasurement</a> function any time a new measurement should be started. A new measurement frame is started and after reading the data from the device, the callback is invoked to inform the host application about the data ready event.</p>
<p>In the meantime, the host application can either poll the module status using the <a class="el" href="group__argus__meas.html#gaa80d0b10b2366f0ade05b4d7b9243497" title="Checks the state of the device/driver.">Argus_GetStatus</a> method or execute other tasks and wait for the measurement data ready callback.</p>
<p>After finishing the measurement cycle, the <a class="el" href="group__argus__meas.html#ga2f130afc115837409b99efaaaf5baedf" title="Evaluates measurement data from the raw sensor readout data.">Argus_EvaluateData</a> function must be called to obtain measurement data like range and signal quality from the raw readout data. Note that it is mandatory to call the evaluation method after each completed measurement cycle. Otherwise, the internal raw data buffer is kept occupied and no new measurements can be triggered anymore. The module contains a double buffer architecture, which allows to start the next measurement and evaluate the current measurement data while the device already executes the next measurement frame.</p>
<p>After evaluation, the <a class="el" href="structargus__results__t.html" title="The measurement results data structure.">argus_results_t</a> data structure is filled with all measurement results that can be processed now be processed by the host application depending on the users needs.</p>
<p>Please note that the laser safety module might refuse to restart a measurement at the time the function is called. This is due to timing constraints dictated by the laser safety rules. In this case, the function does return with <a class="el" href="group__argus__status.html#gga67a0db04d321a74b7e7fcfd3f1a3f70ba3ec68d249b5ffaa0da7e0a1170f592a2">STATUS_ARGUS_POWERLIMIT</a> instead. Use the <a class="el" href="group__argus__cfg.html#gaa6d970c42ac21e56907247f58a029472">frame time </a> and similar parameters to adjust the required pause times via the <a class="el" href="group__argus__cfg.html">configuration API methods</a>.</p>
<p>An example implementation is shown in the <a class="el" href="example_app.html#simple_example_app">Simple Example</a> section.</p>
<h3><a class="anchor" id="autotoc_md6"></a>
Periodic Measurements</h3>
<p>A more advanced way of operating the device is to leverage from a <b>Periodic Interrupt Timer (PIT)</b> and invoke new measurement cycles periodically and autonomously from its interrupt service routine.</p>
<p>The timer is implemented in the <a class="el" href="group__argus__timer.html">timer</a> interface. Instead of calling the <a class="el" href="group__argus__meas.html#ga4c115715544c1f66cf39f1a1f649f093" title="Triggers a single measurement frame asynchronously.">Argus_TriggerMeasurement</a> function periodically from the main thread, the measurement cycles are initiated via the <a class="el" href="group__argus__meas.html#gabe59a112f841d59e435510d3c17c9db1" title="Starts the timer based measurement cycle asynchronously.">Argus_StartMeasurementTimer</a> method. The measurement cycles are restarted in an autonomous way from the periodic interrupt with specified period.</p>
<p>Every time, a new raw measurement data set is ready, the measurement data ready callback is invoked by the API to inform the main thread about the event.</p>
<p>Similar to the previous method, the <a class="el" href="group__argus__meas.html#ga2f130afc115837409b99efaaaf5baedf" title="Evaluates measurement data from the raw sensor readout data.">Argus_EvaluateData</a> function must be called before the data can be used. Note that not calling the function will lead to measurements are not restarted before the evaluation method is called and the data buffers is freed. In the same manner, a slow data evaluation or much user code to delay the data evaluation method might decrease the measurement frame rate.</p>
<p>An example implementation is shown in the <a class="el" href="example_app.html#advanced_example_app">Advanced Example</a> section. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- HTML footer for doxygen 1.8.13-->
<!-- start footer part -->
<div id="nav-path" class="navpath">
	<!-- id is needed for treeview function! -->
	<ul>
		<li class="footer"> 
			<a href="https://www.broadcom.com/">Broadcom Inc.</a>
		</li>
	</ul>
</div>
</body>
</html>
